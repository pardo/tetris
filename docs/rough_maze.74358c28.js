parcelRequire=function(e,r,n,t){var i="function"==typeof parcelRequire&&parcelRequire,o="function"==typeof require&&require;function u(n,t){if(!r[n]){if(!e[n]){var f="function"==typeof parcelRequire&&parcelRequire;if(!t&&f)return f(n,!0);if(i)return i(n,!0);if(o&&"string"==typeof n)return o(n);var c=new Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[n][1][r]||r};var l=r[n]=new u.Module(n);e[n][0].call(l.exports,p,l,l.exports,this)}return r[n].exports;function p(e){return u(p.resolve(e))}}u.isParcelRequire=!0,u.Module=function(e){this.id=e,this.bundle=u,this.exports={}},u.modules=e,u.cache=r,u.parent=i,u.register=function(r,n){e[r]=[function(e,r){r.exports=n},{}]};for(var f=0;f<n.length;f++)u(n[f]);if(n.length){var c=u(n[n.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=c:"function"==typeof define&&define.amd?define(function(){return c}):t&&(this[t]=c)}return u}({"Sr7R":[function(require,module,exports) {

},{}],"lTk1":[function(require,module,exports) {
"use strict";function t(t){t.requestFullscreen?t.requestFullscreen():t.msRequestFullscreen?t.msRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen()}function e(t){var e,n,o,r=t.length;if(0===r)return!1;for(;--r;)e=Math.floor(Math.random()*(r+1)),n=t[r],o=t[e],t[r]=o,t[e]=n;return t}function n(t,e,n){var o,r=[];switch(arguments.length){case 1:for(o=0;o<t;o++)r.push(o);break;case 2:if(e>t)for(o=t;o<e;o++)r.push(o);else for(o=t;o>e;o--)r.push(o);break;case 3:if(t<e&&n>0)for(o=t;o<e;)r.push(o),o+=n;else if(t>e&&n<0)for(o=t;o>e;)r.push(o),o+=n}return r}function o(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function r(t,e,n,o){return Math.sqrt(Math.pow(t-n,2)+Math.pow(e-o,2))}function u(t){return 57.29577951308232*t}function i(t){return t/57.29577951308232}function s(t,e,n,o){var r=Math.atan2(o-e,n-t);return console.log(r),r<0&&(r+=2*Math.PI),r}function a(t,e,n){return{x:t.x+Math.cos(e)*n,y:t.y+Math.sin(e)*n}}function c(t,e){for(var n=Object.keys(e),o=[],r=0;r<n.length;r++)o.push(t(e[n[r]],n[r],r));return o}function h(){var t=0,e=0;return document.body&&document.body.offsetWidth&&(t=document.body.offsetWidth,e=document.body.offsetHeight),"CSS1Compat"===document.compatMode&&document.documentElement&&document.documentElement.offsetWidth&&(t=document.documentElement.offsetWidth,e=document.documentElement.offsetHeight),window.innerWidth&&window.innerHeight&&(t=window.innerWidth,e=window.innerHeight),{width:t,height:e}}function f(t){return{width:t.offsetWidth,height:t.offsetHeight}}function l(t,e){var n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),n.setAttribute("download",t),n.click()}function d(t){var e="";t=t||10;for(var n=0;n<t;n++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return e}function p(t,e,n){var o,r;return function(){var u=this,i=arguments,s=n&&!o;return clearTimeout(o),o=setTimeout(function(){o=null,n||(r=t.apply(u,i))},e),s&&(r=t.apply(u,i)),r}}function m(t,e){var n,o,r,u,i,s,a=p(function(){i=u=!1},e);return function(){n=this,o=arguments;return r||(r=setTimeout(function(){r=null,i&&t.apply(n,o),a()},e)),u?i=!0:s=t.apply(n,o),a(),u=!0,s}}function g(t,e){(t=String(t).replace(/[^0-9a-f]/gi,"")).length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),e=e||0;var n,o,r="#";for(o=0;o<3;o++)n=parseInt(t.substr(2*o,2),16),r+=("00"+(n=Math.round(Math.min(Math.max(0,n+n*e),255)).toString(16))).substr(n.length);return r}function x(){var t,e,n="#";for(e=0;e<3;e++)t=256*Math.random(),n+=("00"+(t=Math.round(Math.min(Math.max(0,t),255)).toString(16))).substr(t.length);return n}function w(){return"ontouchstart"in window||"onmsgesturechange"in window}Object.defineProperty(exports,"__esModule",{value:!0}),exports.debounce=p,exports.throttle=m,exports.getId=d,exports.downloadText=l,exports.getWindowSizePoint=h,exports.mapObj=c,exports.pointFollowingAnglePoint=a,exports.angleBetweenXY=s,exports.deg2rad=i,exports.rad2deg=u,exports.distancePoints=o,exports.distanceXY=r,exports.range=n,exports.FisherYatesShuffle=e,exports.goFullscreen=t,exports.isTouchDevice=w,exports.changeColorLuminance=g,exports.randomHexColor=x,exports.getElementSize=f;
},{}],"BZvA":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var s=require("./helpers"),e={};function t(t,i){this.initialize=function(t){var o;this.options={hard:!1},Object.assign(this.options,i),t&&(o=e[t]),o||(t=this.options.hard?(0,s.FisherYatesShuffle)(["w","o","ii","ca"])[0]:(0,s.FisherYatesShuffle)(["c","s","is","i","l","il","t"])[0],o=e[t]),this.type=t,this.color=o.color,this.shapes=o.shapes,this.offset=o.offset,this.shapeIndex=0},this.rotateClockwise=function(){this.shapeIndex+=1,this.shapeIndex=this.shapeIndex>=this.shapes.length?0:this.shapeIndex},this.rotateCounterClockwise=function(){this.shapeIndex-=1,this.shapeIndex=this.shapeIndex<0?this.shapes.length-1:this.shapeIndex},this.draw=function(s,e){return this.placeOnGround(s,e,"draw")},this.collide=function(s,e){return this.placeOnGround(s,e,"collide")},this.outside=function(s,e){return this.placeOnGround(s,e,"outside")},this.placeOnGround=function(s,e,t){var i=s.ground,o=this.shapes[this.shapeIndex],h=null;function f(s,e,t){return s[e]&&s[e][t]?1-s[e][t]:1}for(var r=0;r<o.length;r++)for(var n=0;n<o[r].length;n++)if(1===o[r][n]){try{var a=n+e[0]-this.offset[0],l=r+e[1]-this.offset[1];h=i[a][l]}catch(s){h=null}if("collide"===t&&h&&!h.empty)return!0;if("draw"===t&&h)h.setColor(this.color),h.empty=!1,h.lines=[f(o,r-1,n),f(o,r,n+1),f(o,r+1,n),f(o,r,n-1)];else if("outside"===t&&null==h)return!0}if("collide"===t||"outside"===t)return!1},this.initialize()}e.is={color:"#64b0ff",shapes:[[[1,1,0],[0,1,1],[0,0,0]],[[0,1,0],[1,1,0],[1,0,0]]],offset:[1,0]},e.s={color:"#008f32",shapes:[[[0,1,1],[1,1,0],[0,0,0]],[[1,0,0],[1,1,0],[0,1,0]]],offset:[1,0]},e.il={color:"#ea9e22",shapes:[[[1,1,1],[0,0,1],[0,0,0]],[[0,1,0],[0,1,0],[1,1,0]],[[1,0,0],[1,1,1],[0,0,0]],[[1,1,0],[1,0,0],[1,0,0]]],offset:[1,0]},e.l={color:"#f26aff",shapes:[[[1,1,1],[1,0,0],[0,0,0]],[[1,1,0],[0,1,0],[0,1,0]],[[0,0,1],[1,1,1],[0,0,0]],[[1,0,0],[1,0,0],[1,1,0]]],offset:[1,0]},e.c={color:"#4240ff",shapes:[[[1,1],[1,1]]],offset:[0,0]},e.t={color:"#afcf30",shapes:[[[1,1,1],[0,1,0],[0,0,0]],[[0,1,0],[1,1,0],[0,1,0]],[[0,1,0],[1,1,1],[0,0,0]],[[1,0,0],[1,1,0],[1,0,0]]],offset:[1,0]},e.i={color:"#b53120",shapes:[[[1,1,1,1],[0,0,0,0],[0,0,0,0],[0,0,0,0]],[[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0]]],offset:[1,0]},e.w={color:"#ffdd00",shapes:[[[1,1,0,0],[0,1,1,0],[0,0,1,1],[0,0,0,1]],[[0,0,0,1],[0,0,1,1],[0,1,1,0],[1,1,0,0]],[[1,0,0,0],[1,1,0,0],[0,1,1,0],[0,0,1,1]],[[0,0,1,1],[0,1,1,0],[1,1,0,0],[1,0,0,0]]],offset:[1,0]},e.o={color:"#04a0fb",shapes:[[[0,1,1,0],[1,0,0,1],[0,1,1,0],[0,0,0,0]],[[0,1,0,0],[1,0,1,0],[1,0,1,0],[0,1,0,0]]],offset:[1,0]},e.ii={color:"#ec1346",shapes:[[[1,0,0,1],[0,0,0,0],[0,0,0,0],[1,0,0,1]],[[1,0,1,0],[0,0,0,0],[1,0,1,0],[0,0,0,0]]],offset:[1,0]},e.ca={color:"#ec1346",shapes:[[[1,1,0],[1,0,0],[1,1,0]],[[1,1,1],[1,0,1],[0,0,0]],[[0,1,1],[0,0,1],[0,1,1]],[[0,0,0],[1,0,1],[1,1,1]]],offset:[1,0]},exports.default=t;
},{"./helpers":"lTk1"}],"W9ez":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var s=require("./helpers"),t=1,i=2,e=4,o=8,n=t+i+e+o;function c(s){for(var t=[],i=0;i<s.length-1;i++)t.push([s[i],s[i+1]]);return t}function a(s,a){var r=s.roughCanvas,h=.1*a.size,l=a.x,u=a.x+a.size,k=a.y,p=a.y+a.size,y=[l+h,k],b=[u-h,k],z=[l,k+h],f=[l+h,k+h],g=[u-h,k+h],C=[u,k+h],m=[l,p-h],x=[l+h,p-h],v=[u-h,p-h],d=[u,p-h],w=[l+h,p],L=[u-h,p],S=[z,f,y],A=[b,g,C],O=[d,v,L],P=[w,x,m],j=[z,C],B=[b,L],G=[d,m],N=[w,y],W=[],_=[],q=45;switch(a.lines){case n:_=[f,g,v,x],W=[[f,g],[g,v],[v,x],[x,f]],q=0;break;case t+e:_=[z,C,d,m],W=[[z,C],[d,m]],q=90;break;case o+i:_=[y,b,L,w],W=[[y,w],[b,L]],q=0;break;case n-t:_=[y,b,v,x],W=[[b,v],[v,x],[x,y]],q=0;break;case n-i:_=[f,C,d,x],W=[[f,C],[d,x],[x,f]],q=90;break;case n-e:_=[f,g,L,w],W=[[f,g],[g,L],[w,f]],q=0;break;case n-o:_=[z,g,v,m],W=[[z,g],[g,v],[v,m]],q=90;break;case o+e:q=45,_=[x,y,b,g,C,d],W=[[b,g],[g,C],[d,x],[x,y]];break;case o+t:q=-45,_=[f,C,d,v,L,w],W=[[f,C],[d,v],[v,L],[w,f]];break;case i+e:q=-45,_=[z,f,y,b,v,m],W=[[z,f],[f,y],[b,v],[v,m]];break;case i+t:q=45,_=[z,g,L,w,x,m],W=[[z,g],[g,L],[w,x],[x,m]];break;case t:_=j.concat(O).concat(P),W=[j].concat(c(O)).concat(c(P)),q=90;break;case i:_=B.concat(P).concat(S),W=[B].concat(c(P)).concat(c(S)),q=0;break;case e:_=G.concat(S).concat(A),W=[G].concat(c(S)).concat(c(A)),q=90;break;case o:_=N.concat(A).concat(O),W=[N].concat(c(A)).concat(c(O)),q=0;break;case 0:_=S.concat(A).concat(O).concat(P),W=[S].concat(c(A)).concat(c(O)).concat(c(P)),q=0}r.polygon(_,{hachureAngle:q,hachureGap:4,roughness:1.8,stroke:"rgba(0,0,0,0.1)",fill:a.color,fillStyle:"zigzag"});var E={strokeWidth:.06*a.size,stroke:a.strokeColor};W.forEach(function(s){r.line(s[0][0],s[0][1],s[1][0],s[1][1],E)})}function r(t,i,e){this.draw=function(s,t){this.empty||a(s,{x:this.x,y:this.y,size:this.size,color:this.color,strokeColor:this.strokeColor,lines:this.getLinesAsNumber()})},this.drawOriginal=function(s,t){var i=s.roughCanvas;this.empty&&!t||(i.rectangle(this.x,this.y,this.size,this.size,{hachureGap:4,roughness:1.8,stroke:"rgba(0,0,0,0.1)",fill:this.empty?this.emptyColor:this.color,fillStyle:"zigzag"}),this.empty||this.drawBlockLines(s))},this.drawBlockLines=function(s){var t=s.roughCanvas,i=.12*this.size,e=this.x,o=this.y,n=this.y+this.size,c=this.x+this.size,a={strokeWidth:.06*this.size,stroke:this.strokeColor};1===this.lines[0]&&t.line(e-i,o,c+i,o,a),1===this.lines[1]&&t.line(c,o-i,c,n+i,a),1===this.lines[2]&&t.line(e-i,n,c+i,n,a),1===this.lines[3]&&t.line(e,o-i,e,n+i,a)},this.setColor=function(t){this.color=t,this.strokeColor=(0,s.changeColorLuminance)(this.color,-.7)+"80"},this.copyFrom=function(s){this.setColor(s.color),this.empty=s.empty,this.lines[0]=s.lines[0],this.lines[1]=s.lines[1],this.lines[2]=s.lines[2],this.lines[3]=s.lines[3]},this.setPos=function(s,t){this.x=s,this.y=t},this.setSize=function(s){this.size=s},this.getLinesAsNumber=function(){return 1*this.lines[0]+2*this.lines[1]+4*this.lines[2]+8*this.lines[3]},this.options={size:15,emptyColor:"#1a1a1a",color:"#1a1a1a"},Object.assign(this.options,e),this.empty=!0,this.emptyColor=this.options.emptyColor,this.setColor(this.options.color),this.setSize(this.options.size),this.setPos(t,i),this.x=t,this.y=i,this.lines=[0,0,0,0]}exports.default=r;
},{"./helpers":"lTk1"}],"J9ef":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var i=require("./block"),t=r(i),o=require("./helpers");function r(i){return i&&i.__esModule?i:{default:i}}function n(i,r,n){var h;this.addRandomBottom=function(i){var t,o,r;for(t=0;t<this.groundWidth;t++)for(o=0;o<this.groundHeight;o++)null!=this.ground[t][o+i]&&this.ground[t][o].copyFrom(this.ground[t][o+i]);for(t=0;t<this.groundWidth;t++)for(o=this.groundHeight-i;o<this.groundHeight;o++)(r=this.ground[t][o]).setColor("#af5089"),Math.random()<.7?(r.empty=!1,r.lines=[1,1,1,1]):r.empty=!0},this.hide=function(i){this.mapGroundBlocks(function(i,t,o){o.empty=!0})},this.setBlockSize=function(i){this.blockSize=i;for(var t=0;t<this.groundWidth;t++)for(var o=0;o<this.groundHeight;o++)this.ground[t][o].setSize(this.blockSize),this.ground[t][o].setPos(t*this.blockSize,o*this.blockSize)},this.meld=function(i){function t(i,t,o,r){return i[r]&&i[r][o]?i[r][o].empty?1:i[r][o].color===t.color?0:1:1}for(var o=0;o<this.groundWidth;o++)for(var r=0;r<this.groundHeight;r++){var n=this.ground[o][r];this.ground[o][r].lines=[t(this.ground,n,r-1,o),t(this.ground,n,r,o+1),t(this.ground,n,r+1,o),t(this.ground,n,r,o-1)]}},this.mapGroundBlocks=function(i){for(var t=0;t<this.groundWidth;t++)for(var o=0;o<this.groundHeight;o++)i(t,o,this.ground[t][o],this.ground)},this.ended=function(){for(var i=0;i<this.groundWidth;i++)if(!this.ground[i][1].empty||!this.ground[i][1].empty)return!0;return!1},this.getCompletedLines=function(){for(var i=[],t=0,o=0;o<this.groundHeight;o++){t=0;for(var r=0;r<this.groundWidth;r++)this.ground[r][o].empty||(t+=1);t===this.groundWidth&&i.push(o)}return i},this.removeLine=function(i){for(var t=0;t<this.groundWidth;t++)for(var o=0;o<this.groundHeight;o++)if(o===i){for(var r=o;r>0;r--)this.ground[t][r].copyFrom(this.ground[t][r-1]);this.ground[t][o].lines[2]=1,this.ground[t][o+1]&&(this.ground[t][o+1].lines[0]=1)}},this.removeLines=function(i){for(var t=0;t<i.length;t++)this.removeLine(i[t])},this.drawGrid=function(i){var t=i.roughCanvas,r={stroke:"rgb(0, 0, 0, 0.5)",strokeWidth:this.blockSize/10,bowing:.6},n={roughness:.6,stroke:"rgb(203, 255, 241, 0.7)",strokeWidth:this.blockSize/40},h=this.groundHeight*this.blockSize,s=this.groundWidth*this.blockSize;(0,o.range)(0,s,this.blockSize).map(function(i){t.line(i,h,i,0,n)}),(0,o.range)(0,h,this.blockSize).map(function(i){t.line(0,i,s,i,n)}),t.line(0,0,s,0,r),t.line(s,0,s,h,r),t.line(s,h,0,h,r),t.line(0,h,0,0,r)},this.groundWidth=i,this.groundHeight=r,this.blockSize=n,this.blocks=[],this.ground=[];for(var s=[],e=0;e<this.groundWidth;e++){s=[];for(var u=0;u<this.groundHeight;u++)h=new t.default(e*this.blockSize,u*this.blockSize,{size:n}),s.push(h),this.blocks.push(h);this.ground.push(s)}}exports.default=n;
},{"./block":"W9ez","./helpers":"lTk1"}],"+LqT":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var i=require("./piece"),e=n(i),t=require("./ground"),o=n(t);function n(i){return i&&i.__esModule?i:{default:i}}function s(i){this.initialize=function(){this.options={width:100,height:100,groundWidth:10,groundHeight:22,drawableBackground:null,drawablePieces:null},Object.assign(this.options,i),this.blockSize=20,this.options.width=this.options.groundWidth*this.blockSize,this.newPiecePosition=[parseInt(this.options.groundWidth/2)-1,0],this.ground=new o.default(this.options.groundWidth,this.options.groundHeight,this.blockSize),this.currentPieceGround=new o.default(this.options.groundWidth,this.options.groundHeight,this.blockSize),this.reset()},this.reset=function(){this.ground.hide(),this.currentPieceGround.hide(),this.ended=!1,this.count={pieces:0,lines:0,linesCount:{1:0,2:0,3:0,4:0},speed:0},this.piecePosition=[this.newPiecePosition[0],this.newPiecePosition[1]],this.piece=new e.default,this.nextPiece=new e.default,this.groundDirty=!0,this.currentPieceGroundDirty=!0},this.serialize=function(i){for(var e=[],t=0;t<this.ground.groundWidth;t++)for(var o=0;o<this.ground.groundHeight;o++){var n=this.currentPieceGround.ground[t][o],s=this.ground.ground[t][o],r=null;s.empty&&!n.empty?r=n:!s.empty&&n.empty&&(r=s),r?e.push([(t<<6)+o,parseInt(r.color.replace("#","0x")),1*r.lines[0]+2*r.lines[1]+4*r.lines[2]+8*r.lines[3]]):e.push([(t<<6)+o])}return e},this.loadSerializedData=function(i){var e=this;i.map(function(i){var t=63&i[0],o=i[0]>>6&63;i[1]?(e.ground.ground[o][t].empty=!1,e.ground.ground[o][t].setColor("#"+("000000"+i[1].toString(16)).slice(-6)),e.ground.ground[o][t].lines=[1&i[2],i[2]>>1&1,i[2]>>2&1,i[2]>>3&1]):e.ground.ground[o][t].empty=!0}),this.currentPieceGroundDirty=!0,this.groundDirty=!0,this.draw()},this.drawPieceGround=function(){this.options.drawablePieces.clear(),this.currentPieceGround.mapGroundBlocks(function(i,e,t){t.draw(this.options.drawablePieces)}.bind(this)),this.currentPieceGroundDirty=!1},this.drawGround=function(){this.options.drawableBackground.clear(),this.ground.drawGrid(this.options.drawableBackground),this.ground.mapGroundBlocks(function(i,e,t){t.draw(this.options.drawableBackground)}.bind(this)),this.groundDirty=!1},this.draw=function(){this.currentPieceGroundDirty&&this.drawPieceGround(),this.groundDirty&&this.drawGround()},this.rotatePiece=function(i,e){this.piece[i]();var t=[this.piecePosition[0],this.piecePosition[1]];(this.piece.collide(this.ground,this.piecePosition)||this.piece.outside(this.ground,this.piecePosition))&&(t=[this.piecePosition[0]-1,this.piecePosition[1]],(this.piece.collide(this.ground,t)||this.piece.outside(this.ground,t))&&(t=[this.piecePosition[0]+1,this.piecePosition[1]],this.piece.collide(this.ground,t)||this.piece.outside(this.ground,t)))?this.piece[e]():(this.piecePosition=t,this.currentPieceGroundDirty=!0,this.currentPieceGround.hide(),this.piece.draw(this.currentPieceGround,this.piecePosition))},this.rotatePieceClockwise=function(){this.rotatePiece("rotateClockwise","rotateCounterClockwise")},this.rotatePieceCounterClockwise=function(){this.rotatePiece("rotateCounterClockwise","rotateClockwise")},this.pieceMove=function(i){var e=[this.piecePosition[0]+i,this.piecePosition[1]];this.piece.collide(this.ground,e)||this.piece.outside(this.ground,e)||(this.piecePosition=e,this.currentPieceGroundDirty=!0,this.currentPieceGround.hide(),this.piece.draw(this.currentPieceGround,this.piecePosition))},this.pieceMoveLeft=function(){this.pieceMove(-1)},this.pieceMoveRight=function(){this.pieceMove(1)},this.pieceMoveDown=function(i){if(!this.ended){var t={};if(Object.assign(t,{auto:!1},i),this.piecePosition[1]+=1,this.piece.collide(this.ground,this.piecePosition)||this.piece.outside(this.ground,this.piecePosition)){this.piecePosition[1]-=1,this.piece.draw(this.ground,this.piecePosition),this.piecePosition=[this.newPiecePosition[0],this.newPiecePosition[1]],this.piece=this.nextPiece,this.nextPiece=new e.default;var o=this.ground.getCompletedLines();o.length>0&&(this.count.linesCount[o.length]+=1,this.linesRemovedCallback(this,o)),this.count.lines+=o.length,this.count.pieces+=1,this.newPieceCallback(this,this.piece,this.nextPiece,o),this.ground.removeLines(o),this.ground.ended()&&(this.ended=!0,this.ground.mapGroundBlocks(function(i,e,t){t.setColor("#777777")}),this.gameEndedCallback(this)),this.ground.meld(),this.groundDirty=!0}t.auto||(this.count.speed+=1),this.currentPieceGround.hide(),this.piece.draw(this.currentPieceGround,this.piecePosition),this.currentPieceGroundDirty=!0}},this.resize=function(i){this.blockSize=i,this.ground.setBlockSize(this.blockSize),this.currentPieceGround.setBlockSize(this.blockSize),this.groundDirty=!0,this.currentPieceGroundDirty=!0},this.getPoints=function(){return 10*this.count.linesCount[1]+20*this.count.linesCount[2]+45*this.count.linesCount[3]+70*this.count.linesCount[4]+3*this.count.pieces+8*this.count.speed},this.makeNextPieceHardOne=function(){this.nextPiece=new e.default(null,{hard:!0})},this.addRandomBottom=function(i){void 0===i&&(i=Math.ceil(4*Math.random())),this.ground.addRandomBottom(i),this.groundDirty=!0},this.linesRemovedCallback=function(i,e){},this.gameEndedCallback=function(i){},this.newPieceCallback=function(i,e,t,o){},this.initialize()}exports.default=s;
},{"./piece":"BZvA","./ground":"J9ef"}],"6dwr":[function(require,module,exports) {
"use strict";function t(t,s){return t.type===s}Object.defineProperty(exports,"__esModule",{value:!0});const s={A:7,a:7,C:6,c:6,H:1,h:1,L:2,l:2,M:2,m:2,Q:4,q:4,S:4,s:4,T:4,t:2,V:1,v:1,Z:0,z:0};class i{constructor(t){this.COMMAND=0,this.NUMBER=1,this.EOD=2,this.segments=[],this.parseData(t),this.processPoints()}tokenize(t){const s=new Array;for(;""!==t;)if(t.match(/^([ \t\r\n,]+)/))t=t.substr(RegExp.$1.length);else if(t.match(/^([aAcChHlLmMqQsStTvVzZ])/))s[s.length]={type:this.COMMAND,text:RegExp.$1},t=t.substr(RegExp.$1.length);else{if(!t.match(/^(([-+]?[0-9]+(\.[0-9]*)?|[-+]?\.[0-9]+)([eE][-+]?[0-9]+)?)/))return console.error("Unrecognized segment command: "+t),[];s[s.length]={type:this.NUMBER,text:`${parseFloat(RegExp.$1)}`},t=t.substr(RegExp.$1.length)}return s[s.length]={type:this.EOD,text:""},s}parseData(i){const e=this.tokenize(i);let h=0,r=e[h],a="BOD";for(this.segments=new Array;!t(r,this.EOD);){let n;const o=new Array;if("BOD"===a){if("M"!==r.text&&"m"!==r.text)return void this.parseData("M0,0"+i);h++,n=s[r.text],a=r.text}else t(r,this.NUMBER)?n=s[a]:(h++,n=s[r.text],a=r.text);if(h+n<e.length){for(let s=h;s<h+n;s++){const i=e[s];if(!t(i,this.NUMBER))return void console.error("Parameter type is not a number: "+a+","+i.text);o[o.length]=+i.text}if("number"!=typeof s[a])return void console.error("Unsupported segment type: "+a);{const t={key:a,data:o};this.segments.push(t),r=e[h+=n],"M"===a&&(a="L"),"m"===a&&(a="l")}}else console.error("Path data ended before all parameters were found")}}get closed(){if(void 0===this._closed){this._closed=!1;for(const t of this.segments)"z"===t.key.toLowerCase()&&(this._closed=!0)}return this._closed}processPoints(){let t=null,s=[0,0];for(let i=0;i<this.segments.length;i++){const e=this.segments[i];switch(e.key){case"M":case"L":case"T":e.point=[e.data[0],e.data[1]];break;case"m":case"l":case"t":e.point=[e.data[0]+s[0],e.data[1]+s[1]];break;case"H":e.point=[e.data[0],s[1]];break;case"h":e.point=[e.data[0]+s[0],s[1]];break;case"V":e.point=[s[0],e.data[0]];break;case"v":e.point=[s[0],e.data[0]+s[1]];break;case"z":case"Z":t&&(e.point=[t[0],t[1]]);break;case"C":e.point=[e.data[4],e.data[5]];break;case"c":e.point=[e.data[4]+s[0],e.data[5]+s[1]];break;case"S":e.point=[e.data[2],e.data[3]];break;case"s":e.point=[e.data[2]+s[0],e.data[3]+s[1]];break;case"Q":e.point=[e.data[2],e.data[3]];break;case"q":e.point=[e.data[2]+s[0],e.data[3]+s[1]];break;case"A":e.point=[e.data[5],e.data[6]];break;case"a":e.point=[e.data[5]+s[0],e.data[6]+s[1]]}"m"!==e.key&&"M"!==e.key||(t=null),e.point&&(s=e.point,t||(t=e.point)),"z"!==e.key&&"Z"!==e.key||(t=null)}}}class e{constructor(t){this._position=[0,0],this._first=null,this.bezierReflectionPoint=null,this.quadReflectionPoint=null,this.parsed=new i(t)}get segments(){return this.parsed.segments}get closed(){return this.parsed.closed}get linearPoints(){if(!this._linearPoints){const t=[];let s=[];for(const i of this.parsed.segments){const e=i.key.toLowerCase();("m"!==e&&"z"!==e||(s.length&&(t.push(s),s=[]),"z"!==e))&&(i.point&&s.push(i.point))}s.length&&(t.push(s),s=[]),this._linearPoints=t}return this._linearPoints}get first(){return this._first}set first(t){this._first=t}setPosition(t,s){this._position=[t,s],this._first||(this._first=[t,s])}get position(){return this._position}get x(){return this._position[0]}get y(){return this._position[1]}}exports.RoughPath=e;class h{constructor(t,s,i,e,h,r){if(this._segIndex=0,this._numSegs=0,this._rx=0,this._ry=0,this._sinPhi=0,this._cosPhi=0,this._C=[0,0],this._theta=0,this._delta=0,this._T=0,this._from=t,t[0]===s[0]&&t[1]===s[1])return;const a=Math.PI/180;this._rx=Math.abs(i[0]),this._ry=Math.abs(i[1]),this._sinPhi=Math.sin(e*a),this._cosPhi=Math.cos(e*a);const n=this._cosPhi*(t[0]-s[0])/2+this._sinPhi*(t[1]-s[1])/2,o=-this._sinPhi*(t[0]-s[0])/2+this._cosPhi*(t[1]-s[1])/2;let c=0;const _=this._rx*this._rx*this._ry*this._ry-this._rx*this._rx*o*o-this._ry*this._ry*n*n;if(_<0){const t=Math.sqrt(1-_/(this._rx*this._rx*this._ry*this._ry));this._rx=this._rx*t,this._ry=this._ry*t,c=0}else c=(h===r?-1:1)*Math.sqrt(_/(this._rx*this._rx*o*o+this._ry*this._ry*n*n));const l=c*this._rx*o/this._ry,d=-c*this._ry*n/this._rx;this._C=[0,0],this._C[0]=this._cosPhi*l-this._sinPhi*d+(t[0]+s[0])/2,this._C[1]=this._sinPhi*l+this._cosPhi*d+(t[1]+s[1])/2,this._theta=this.calculateVectorAngle(1,0,(n-l)/this._rx,(o-d)/this._ry);let p=this.calculateVectorAngle((n-l)/this._rx,(o-d)/this._ry,(-n-l)/this._rx,(-o-d)/this._ry);!r&&p>0?p-=2*Math.PI:r&&p<0&&(p+=2*Math.PI),this._numSegs=Math.ceil(Math.abs(p/(Math.PI/2))),this._delta=p/this._numSegs,this._T=8/3*Math.sin(this._delta/4)*Math.sin(this._delta/4)/Math.sin(this._delta/2)}getNextSegment(){if(this._segIndex===this._numSegs)return null;const t=Math.cos(this._theta),s=Math.sin(this._theta),i=this._theta+this._delta,e=Math.cos(i),h=Math.sin(i),r=[this._cosPhi*this._rx*e-this._sinPhi*this._ry*h+this._C[0],this._sinPhi*this._rx*e+this._cosPhi*this._ry*h+this._C[1]],a=[this._from[0]+this._T*(-this._cosPhi*this._rx*s-this._sinPhi*this._ry*t),this._from[1]+this._T*(-this._sinPhi*this._rx*s+this._cosPhi*this._ry*t)],n=[r[0]+this._T*(this._cosPhi*this._rx*h+this._sinPhi*this._ry*e),r[1]+this._T*(this._sinPhi*this._rx*h-this._cosPhi*this._ry*e)];return this._theta=i,this._from=[r[0],r[1]],this._segIndex++,{cp1:a,cp2:n,to:r}}calculateVectorAngle(t,s,i,e){const h=Math.atan2(s,t),r=Math.atan2(e,i);return r>=h?r-h:2*Math.PI-(h-r)}}exports.RoughArcConverter=h;class r{constructor(t,s){this.sets=t,this.closed=s}fit(t){const s=[];for(const i of this.sets){const e=i.length;let h=Math.floor(t*e);if(h<5){if(e<=5)continue;h=5}s.push(this.reduce(i,h))}let i="";for(const t of s){for(let s=0;s<t.length;s++){const e=t[s];i+=0===s?"M"+e[0]+","+e[1]:"L"+e[0]+","+e[1]}this.closed&&(i+="z ")}return i}distance(t,s){return Math.sqrt(Math.pow(t[0]-s[0],2)+Math.pow(t[1]-s[1],2))}reduce(t,s){if(t.length<=s)return t;const i=t.slice(0);for(;i.length>s;){const t=[];let s=-1,e=-1;for(let h=1;h<i.length-1;h++){const r=this.distance(i[h-1],i[h]),a=this.distance(i[h],i[h+1]),n=this.distance(i[h-1],i[h+1]),o=(r+a+n)/2,c=Math.sqrt(o*(o-r)*(o-a)*(o-n));t.push(c),(s<0||c<s)&&(s=c,e=h)}if(!(e>0))break;i.splice(e,1)}return i}}exports.PathFitter=r;
},{}],"ZFo7":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class i{constructor(i,t){this.xi=Number.MAX_VALUE,this.yi=Number.MAX_VALUE,this.px1=i[0],this.py1=i[1],this.px2=t[0],this.py2=t[1],this.a=this.py2-this.py1,this.b=this.px1-this.px2,this.c=this.px2*this.py1-this.px1*this.py2,this._undefined=0===this.a&&0===this.b&&0===this.c}isUndefined(){return this._undefined}intersects(i){if(this.isUndefined()||i.isUndefined())return!1;let t=Number.MAX_VALUE,s=Number.MAX_VALUE,h=0,p=0;const x=this.a,y=this.b,e=this.c;return Math.abs(y)>1e-5&&(t=-x/y,h=-e/y),Math.abs(i.b)>1e-5&&(s=-i.a/i.b,p=-i.c/i.b),t===Number.MAX_VALUE?s===Number.MAX_VALUE?-e/x==-i.c/i.a&&(this.py1>=Math.min(i.py1,i.py2)&&this.py1<=Math.max(i.py1,i.py2)?(this.xi=this.px1,this.yi=this.py1,!0):this.py2>=Math.min(i.py1,i.py2)&&this.py2<=Math.max(i.py1,i.py2)&&(this.xi=this.px2,this.yi=this.py2,!0)):(this.xi=this.px1,this.yi=s*this.xi+p,!((this.py1-this.yi)*(this.yi-this.py2)<-1e-5||(i.py1-this.yi)*(this.yi-i.py2)<-1e-5)&&(!(Math.abs(i.a)<1e-5)||!((i.px1-this.xi)*(this.xi-i.px2)<-1e-5))):s===Number.MAX_VALUE?(this.xi=i.px1,this.yi=t*this.xi+h,!((i.py1-this.yi)*(this.yi-i.py2)<-1e-5||(this.py1-this.yi)*(this.yi-this.py2)<-1e-5)&&(!(Math.abs(x)<1e-5)||!((this.px1-this.xi)*(this.xi-this.px2)<-1e-5))):t===s?h===p&&(this.px1>=Math.min(i.px1,i.px2)&&this.px1<=Math.max(i.py1,i.py2)?(this.xi=this.px1,this.yi=this.py1,!0):this.px2>=Math.min(i.px1,i.px2)&&this.px2<=Math.max(i.px1,i.px2)&&(this.xi=this.px2,this.yi=this.py2,!0)):(this.xi=(p-h)/(t-s),this.yi=t*this.xi+h,!((this.px1-this.xi)*(this.xi-this.px2)<-1e-5||(i.px1-this.xi)*(this.xi-i.px2)<-1e-5))}}exports.Segment=i;
},{}],"Z20O":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.HachureIterator=void 0;var t=require("../geometry");class s{constructor(s,i,h,e,o,r,a,n){this.deltaX=0,this.hGap=0,this.top=s,this.bottom=i,this.left=h,this.right=e,this.gap=o,this.sinAngle=r,this.tanAngle=n,Math.abs(r)<1e-4?this.pos=h+o:Math.abs(r)>.9999?this.pos=s+o:(this.deltaX=(i-s)*Math.abs(n),this.pos=h-Math.abs(this.deltaX),this.hGap=Math.abs(o/a),this.sLeft=new t.Segment([h,i],[h,s]),this.sRight=new t.Segment([e,i],[e,s]))}nextLine(){if(Math.abs(this.sinAngle)<1e-4){if(this.pos<this.right){const t=[this.pos,this.top,this.pos,this.bottom];return this.pos+=this.gap,t}}else if(Math.abs(this.sinAngle)>.9999){if(this.pos<this.bottom){const t=[this.left,this.pos,this.right,this.pos];return this.pos+=this.gap,t}}else{let s=this.pos-this.deltaX/2,i=this.pos+this.deltaX/2,h=this.bottom,e=this.top;if(this.pos<this.right+this.deltaX){for(;s<this.left&&i<this.left||s>this.right&&i>this.right;)if(this.pos+=this.hGap,s=this.pos-this.deltaX/2,i=this.pos+this.deltaX/2,this.pos>this.right+this.deltaX)return null;const o=new t.Segment([s,h],[i,e]);this.sLeft&&o.intersects(this.sLeft)&&(s=o.xi,h=o.yi),this.sRight&&o.intersects(this.sRight)&&(i=o.xi,e=o.yi),this.tanAngle>0&&(s=this.right-(s-this.left),i=this.right-(i-this.left));const r=[s,h,i,e];return this.pos+=this.hGap,r}}return null}}exports.HachureIterator=s;
},{"../geometry":"ZFo7"}],"s8Ae":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.lineLength=n,exports.getIntersectingLines=r,exports.affine=h,exports.hachureLinesForPolygon=s,exports.hachureLinesForEllipse=o;var t=require("../geometry"),e=require("../utils/hachure");function n(t){const e=t[0],n=t[1];return Math.sqrt(Math.pow(e[0]-n[0],2)+Math.pow(e[1]-n[1],2))}function r(e,n){const r=[],h=new t.Segment([e[0],e[1]],[e[2],e[3]]);for(let e=0;e<n.length;e++){const s=new t.Segment(n[e],n[(e+1)%n.length]);h.intersects(s)&&r.push([h.xi,h.yi])}return r}function h(t,e,n,r,h,s,o){return[-n*s-r*h+n+s*t+h*e,o*(n*h-r*s)+r+-o*h*t+o*s*e]}function s(t,n){const h=[];if(t&&t.length){let s=t[0][0],o=t[0][0],a=t[0][1],i=t[0][1];for(let e=1;e<t.length;e++)s=Math.min(s,t[e][0]),o=Math.max(o,t[e][0]),a=Math.min(a,t[e][1]),i=Math.max(i,t[e][1]);const c=n.hachureAngle;let l=n.hachureGap;l<0&&(l=4*n.strokeWidth),l=Math.max(l,.1);const u=c%180*(Math.PI/180),M=Math.cos(u),f=Math.sin(u),g=Math.tan(u),p=new e.HachureIterator(a-1,i+1,s-1,o+1,l,f,M,g);let x;for(;null!=(x=p.nextLine());){const e=r(x,t);for(let t=0;t<e.length;t++)if(t<e.length-1){const n=e[t],r=e[t+1];h.push([n,r])}}}return h}function o(t,e,n,r,s,o){const a=[];let i=Math.abs(n/2),c=Math.abs(r/2);i+=o.getOffset(.05*-i,.05*i,s),c+=o.getOffset(.05*-c,.05*c,s);const l=s.hachureAngle;let u=s.hachureGap;u<=0&&(u=4*s.strokeWidth);let M=s.fillWeight;M<0&&(M=s.strokeWidth/2);const f=l%180*(Math.PI/180),g=Math.tan(f),p=c/i,x=Math.sqrt(p*g*p*g+1),m=p*g/x,q=1/x,d=u/(i*c/Math.sqrt(c*q*(c*q)+i*m*(i*m))/i);let w=Math.sqrt(i*i-(t-i+d)*(t-i+d));for(let n=t-i+d;n<t+i;n+=d){const r=h(n,e-(w=Math.sqrt(i*i-(t-n)*(t-n))),t,e,m,q,p),s=h(n,e+w,t,e,m,q,p);a.push([r,s])}return a}
},{"../geometry":"ZFo7","../utils/hachure":"Z20O"}],"1bDT":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.HachureFiller=void 0;var e=require("./filler-utils");class r{constructor(e){this.renderer=e}fillPolygon(e,r){return this._fillPolygon(e,r)}fillEllipse(e,r,l,i,t){return this._fillEllipse(e,r,l,i,t)}_fillPolygon(r,l,i=!1){const t=(0,e.hachureLinesForPolygon)(r,l);return{type:"fillSketch",ops:this.renderLines(t,l,i)}}_fillEllipse(r,l,i,t,s,n=!1){const o=(0,e.hachureLinesForEllipse)(r,l,i,t,s,this.renderer);return{type:"fillSketch",ops:this.renderLines(o,s,n)}}renderLines(e,r,l){let i=[],t=null;for(const s of e)i=i.concat(this.renderer.doubleLine(s[0][0],s[0][1],s[1][0],s[1][1],r)),l&&t&&(i=i.concat(this.renderer.doubleLine(t[0],t[1],s[0][0],s[0][1],r))),t=s[1];return i}}exports.HachureFiller=r;
},{"./filler-utils":"s8Ae"}],"kQNz":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ZigZagFiller=void 0;var e=require("./hachure-filler");class l extends e.HachureFiller{fillPolygon(e,l){return this._fillPolygon(e,l,!0)}fillEllipse(e,l,r,i,s){return this._fillEllipse(e,l,r,i,s,!0)}}exports.ZigZagFiller=l;
},{"./hachure-filler":"1bDT"}],"crls":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.HatchFiller=void 0;var e=require("./hachure-filler");class l extends e.HachureFiller{fillPolygon(e,l){const s=this._fillPolygon(e,l),i=Object.assign({},l,{hachureAngle:l.hachureAngle+90}),r=this._fillPolygon(e,i);return s.ops=s.ops.concat(r.ops),s}fillEllipse(e,l,s,i,r){const o=this._fillEllipse(e,l,s,i,r),t=Object.assign({},r,{hachureAngle:r.hachureAngle+90}),c=this._fillEllipse(e,l,s,i,t);return o.ops=o.ops.concat(c.ops),o}}exports.HatchFiller=l;
},{"./hachure-filler":"1bDT"}],"gtrK":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DotFiller=void 0;var e=require("./filler-utils");class t{constructor(e){this.renderer=e}fillPolygon(t,r){r=Object.assign({},r,{curveStepCount:4,hachureAngle:0});const s=(0,e.hachureLinesForPolygon)(t,r);return this.dotsOnLines(s,r)}fillEllipse(t,r,s,n,i){i=Object.assign({},i,{curveStepCount:4,hachureAngle:0});const o=(0,e.hachureLinesForEllipse)(t,r,s,n,i,this.renderer);return this.dotsOnLines(o,i)}dotsOnLines(t,r){let s=[],n=r.hachureGap;n<0&&(n=4*r.strokeWidth),n=Math.max(n,.1);let i=r.fillWeight;i<0&&(i=r.strokeWidth/2);for(const o of t){const t=(0,e.lineLength)(o)/n,l=Math.ceil(t)-1,h=Math.atan((o[1][1]-o[0][1])/(o[1][0]-o[0][0]));for(let e=0;e<l;e++){const t=n*(e+1),l=t*Math.sin(h),c=t*Math.cos(h),a=[o[0][0]-c,o[0][1]+l],u=this.renderer.getOffset(a[0]-n/4,a[0]+n/4,r),d=this.renderer.getOffset(a[1]-n/4,a[1]+n/4,r),f=this.renderer.ellipse(u,d,i,i,r);s=s.concat(f.ops)}}return{type:"fillSketch",ops:s}}}exports.DotFiller=t;
},{"./filler-utils":"s8Ae"}],"L90K":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getFiller=t;var e=require("./hachure-filler"),r=require("./zigzag-filler"),l=require("./hatch-filler"),i=require("./dot-filler");const a={};function t(t,c){let h=c.fillStyle||"hachure";if(!a[h])switch(h){case"zigzag":a[h]||(a[h]=new r.ZigZagFiller(t));break;case"cross-hatch":a[h]||(a[h]=new l.HatchFiller(t));break;case"dots":a[h]||(a[h]=new i.DotFiller(t));break;case"hachure":default:a[h="hachure"]||(a[h]=new e.HachureFiller(t))}return a[h]}
},{"./hachure-filler":"1bDT","./zigzag-filler":"kQNz","./hatch-filler":"crls","./dot-filler":"gtrK"}],"1NlH":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RoughRenderer=void 0;var t=require("./path.js"),e=require("./fillers/filler");class s{line(t,e,s,a,h){return{type:"path",ops:this.doubleLine(t,e,s,a,h)}}linearPath(t,e,s){const a=(t||[]).length;if(a>2){let h=[];for(let e=0;e<a-1;e++)h=h.concat(this.doubleLine(t[e][0],t[e][1],t[e+1][0],t[e+1][1],s));return e&&(h=h.concat(this.doubleLine(t[a-1][0],t[a-1][1],t[0][0],t[0][1],s))),{type:"path",ops:h}}return 2===a?this.line(t[0][0],t[0][1],t[1][0],t[1][1],s):{type:"path",ops:[]}}polygon(t,e){return this.linearPath(t,!0,e)}rectangle(t,e,s,a,h){const i=[[t,e],[t+s,e],[t+s,e+a],[t,e+a]];return this.polygon(i,h)}curve(t,e){const s=this._curveWithOffset(t,1*(1+.2*e.roughness),e),a=this._curveWithOffset(t,1.5*(1+.22*e.roughness),e);return{type:"path",ops:s.concat(a)}}ellipse(t,e,s,a,h){const i=2*Math.PI/h.curveStepCount;let f=Math.abs(s/2),o=Math.abs(a/2);f+=this.getOffset(.05*-f,.05*f,h),o+=this.getOffset(.05*-o,.05*o,h);const n=this._ellipse(i,t,e,f,o,1,i*this.getOffset(.1,this.getOffset(.4,1,h),h),h),c=this._ellipse(i,t,e,f,o,1.5,0,h);return{type:"path",ops:n.concat(c)}}arc(t,e,s,a,h,i,f,o,n){const c=t,l=e;let r=Math.abs(s/2),g=Math.abs(a/2);r+=this.getOffset(.01*-r,.01*r,n),g+=this.getOffset(.01*-g,.01*g,n);let u=h,p=i;for(;u<0;)u+=2*Math.PI,p+=2*Math.PI;p-u>2*Math.PI&&(u=0,p=2*Math.PI);const O=2*Math.PI/n.curveStepCount,d=Math.min(O/2,(p-u)/2),M=this._arc(d,c,l,r,g,u,p,1,n),y=this._arc(d,c,l,r,g,u,p,1.5,n);let b=M.concat(y);return f&&(o?b=(b=b.concat(this.doubleLine(c,l,c+r*Math.cos(u),l+g*Math.sin(u),n))).concat(this.doubleLine(c,l,c+r*Math.cos(p),l+g*Math.sin(p),n)):(b.push({op:"lineTo",data:[c,l]}),b.push({op:"lineTo",data:[c+r*Math.cos(u),l+g*Math.sin(u)]}))),{type:"path",ops:b}}svgPath(e,s){e=(e||"").replace(/\n/g," ").replace(/(-\s)/g,"-").replace("/(ss)/g"," ");let a=new t.RoughPath(e);if(s.simplification){const e=new t.PathFitter(a.linearPoints,a.closed).fit(s.simplification);a=new t.RoughPath(e)}let h=[];const i=a.segments||[];for(let t=0;t<i.length;t++){const e=i[t],f=t>0?i[t-1]:null,o=this._processSegment(a,e,f,s);o&&o.length&&(h=h.concat(o))}return{type:"path",ops:h}}solidFillPolygon(t,e){const s=[];if(t.length){const a=e.maxRandomnessOffset||0,h=t.length;if(h>2){s.push({op:"move",data:[t[0][0]+this.getOffset(-a,a,e),t[0][1]+this.getOffset(-a,a,e)]});for(let i=1;i<h;i++)s.push({op:"lineTo",data:[t[i][0]+this.getOffset(-a,a,e),t[i][1]+this.getOffset(-a,a,e)]})}}return{type:"fillPath",ops:s}}patternFillPolygon(t,s){return(0,e.getFiller)(this,s).fillPolygon(t,s)}patternFillEllipse(t,s,a,h,i){return(0,e.getFiller)(this,i).fillEllipse(t,s,a,h,i)}patternFillArc(t,e,s,a,h,i,f){const o=t,n=e;let c=Math.abs(s/2),l=Math.abs(a/2);c+=this.getOffset(.01*-c,.01*c,f),l+=this.getOffset(.01*-l,.01*l,f);let r=h,g=i;for(;r<0;)r+=2*Math.PI,g+=2*Math.PI;g-r>2*Math.PI&&(r=0,g=2*Math.PI);const u=(g-r)/f.curveStepCount,p=[];for(let t=r;t<=g;t+=u)p.push([o+c*Math.cos(t),n+l*Math.sin(t)]);return p.push([o+c*Math.cos(g),n+l*Math.sin(g)]),p.push([o,n]),this.patternFillPolygon(p,f)}getOffset(t,e,s){return s.roughness*(Math.random()*(e-t)+t)}doubleLine(t,e,s,a,h){const i=this._line(t,e,s,a,h,!0,!1),f=this._line(t,e,s,a,h,!0,!0);return i.concat(f)}_line(t,e,s,a,h,i,f){const o=Math.pow(t-s,2)+Math.pow(e-a,2);let n=h.maxRandomnessOffset||0;n*n*100>o&&(n=Math.sqrt(o)/10);const c=n/2,l=.2+.2*Math.random();let r=h.bowing*h.maxRandomnessOffset*(a-e)/200,g=h.bowing*h.maxRandomnessOffset*(t-s)/200;r=this.getOffset(-r,r,h),g=this.getOffset(-g,g,h);const u=[];return i&&(f?u.push({op:"move",data:[t+this.getOffset(-c,c,h),e+this.getOffset(-c,c,h)]}):u.push({op:"move",data:[t+this.getOffset(-n,n,h),e+this.getOffset(-n,n,h)]})),f?u.push({op:"bcurveTo",data:[r+t+(s-t)*l+this.getOffset(-c,c,h),g+e+(a-e)*l+this.getOffset(-c,c,h),r+t+2*(s-t)*l+this.getOffset(-c,c,h),g+e+2*(a-e)*l+this.getOffset(-c,c,h),s+this.getOffset(-c,c,h),a+this.getOffset(-c,c,h)]}):u.push({op:"bcurveTo",data:[r+t+(s-t)*l+this.getOffset(-n,n,h),g+e+(a-e)*l+this.getOffset(-n,n,h),r+t+2*(s-t)*l+this.getOffset(-n,n,h),g+e+2*(a-e)*l+this.getOffset(-n,n,h),s+this.getOffset(-n,n,h),a+this.getOffset(-n,n,h)]}),u}_curve(t,e,s){const a=t.length;let h=[];if(a>3){const i=[],f=1-s.curveTightness;h.push({op:"move",data:[t[1][0],t[1][1]]});for(let e=1;e+2<a;e++){const s=t[e];i[0]=[s[0],s[1]],i[1]=[s[0]+(f*t[e+1][0]-f*t[e-1][0])/6,s[1]+(f*t[e+1][1]-f*t[e-1][1])/6],i[2]=[t[e+1][0]+(f*t[e][0]-f*t[e+2][0])/6,t[e+1][1]+(f*t[e][1]-f*t[e+2][1])/6],i[3]=[t[e+1][0],t[e+1][1]],h.push({op:"bcurveTo",data:[i[1][0],i[1][1],i[2][0],i[2][1],i[3][0],i[3][1]]})}if(e&&2===e.length){const t=s.maxRandomnessOffset;h.push({op:"lineTo",data:[e[0]+this.getOffset(-t,t,s),e[1]+ +this.getOffset(-t,t,s)]})}}else 3===a?(h.push({op:"move",data:[t[1][0],t[1][1]]}),h.push({op:"bcurveTo",data:[t[1][0],t[1][1],t[2][0],t[2][1],t[2][0],t[2][1]]})):2===a&&(h=h.concat(this.doubleLine(t[0][0],t[0][1],t[1][0],t[1][1],s)));return h}_ellipse(t,e,s,a,h,i,f,o){const n=this.getOffset(-.5,.5,o)-Math.PI/2,c=[];c.push([this.getOffset(-i,i,o)+e+.9*a*Math.cos(n-t),this.getOffset(-i,i,o)+s+.9*h*Math.sin(n-t)]);for(let f=n;f<2*Math.PI+n-.01;f+=t)c.push([this.getOffset(-i,i,o)+e+a*Math.cos(f),this.getOffset(-i,i,o)+s+h*Math.sin(f)]);return c.push([this.getOffset(-i,i,o)+e+a*Math.cos(n+2*Math.PI+.5*f),this.getOffset(-i,i,o)+s+h*Math.sin(n+2*Math.PI+.5*f)]),c.push([this.getOffset(-i,i,o)+e+.98*a*Math.cos(n+f),this.getOffset(-i,i,o)+s+.98*h*Math.sin(n+f)]),c.push([this.getOffset(-i,i,o)+e+.9*a*Math.cos(n+.5*f),this.getOffset(-i,i,o)+s+.9*h*Math.sin(n+.5*f)]),this._curve(c,null,o)}_curveWithOffset(t,e,s){const a=[];a.push([t[0][0]+this.getOffset(-e,e,s),t[0][1]+this.getOffset(-e,e,s)]),a.push([t[0][0]+this.getOffset(-e,e,s),t[0][1]+this.getOffset(-e,e,s)]);for(let h=1;h<t.length;h++)a.push([t[h][0]+this.getOffset(-e,e,s),t[h][1]+this.getOffset(-e,e,s)]),h===t.length-1&&a.push([t[h][0]+this.getOffset(-e,e,s),t[h][1]+this.getOffset(-e,e,s)]);return this._curve(a,null,s)}_arc(t,e,s,a,h,i,f,o,n){const c=i+this.getOffset(-.1,.1,n),l=[];l.push([this.getOffset(-o,o,n)+e+.9*a*Math.cos(c-t),this.getOffset(-o,o,n)+s+.9*h*Math.sin(c-t)]);for(let i=c;i<=f;i+=t)l.push([this.getOffset(-o,o,n)+e+a*Math.cos(i),this.getOffset(-o,o,n)+s+h*Math.sin(i)]);return l.push([e+a*Math.cos(f),s+h*Math.sin(f)]),l.push([e+a*Math.cos(f),s+h*Math.sin(f)]),this._curve(l,null,n)}_bezierTo(t,e,s,a,h,i,f,o){const n=[],c=[o.maxRandomnessOffset||1,(o.maxRandomnessOffset||1)+.5];let l=[0,0];for(let r=0;r<2;r++)0===r?n.push({op:"move",data:[f.x,f.y]}):n.push({op:"move",data:[f.x+this.getOffset(-c[0],c[0],o),f.y+this.getOffset(-c[0],c[0],o)]}),l=[h+this.getOffset(-c[r],c[r],o),i+this.getOffset(-c[r],c[r],o)],n.push({op:"bcurveTo",data:[t+this.getOffset(-c[r],c[r],o),e+this.getOffset(-c[r],c[r],o),s+this.getOffset(-c[r],c[r],o),a+this.getOffset(-c[r],c[r],o),l[0],l[1]]});return f.setPosition(l[0],l[1]),n}_processSegment(e,s,a,h){let i=[];switch(s.key){case"M":case"m":{const t="m"===s.key;if(s.data.length>=2){let a=+s.data[0],f=+s.data[1];t&&(a+=e.x,f+=e.y);const o=1*(h.maxRandomnessOffset||0);a+=this.getOffset(-o,o,h),f+=this.getOffset(-o,o,h),e.setPosition(a,f),i.push({op:"move",data:[a,f]})}break}case"L":case"l":{const t="l"===s.key;if(s.data.length>=2){let a=+s.data[0],f=+s.data[1];t&&(a+=e.x,f+=e.y),i=i.concat(this.doubleLine(e.x,e.y,a,f,h)),e.setPosition(a,f)}break}case"H":case"h":{const t="h"===s.key;if(s.data.length){let a=+s.data[0];t&&(a+=e.x),i=i.concat(this.doubleLine(e.x,e.y,a,e.y,h)),e.setPosition(a,e.y)}break}case"V":case"v":{const t="v"===s.key;if(s.data.length){let a=+s.data[0];t&&(a+=e.y),i=i.concat(this.doubleLine(e.x,e.y,e.x,a,h)),e.setPosition(e.x,a)}break}case"Z":case"z":e.first&&(i=i.concat(this.doubleLine(e.x,e.y,e.first[0],e.first[1],h)),e.setPosition(e.first[0],e.first[1]),e.first=null);break;case"C":case"c":{const t="c"===s.key;if(s.data.length>=6){let a=+s.data[0],f=+s.data[1],o=+s.data[2],n=+s.data[3],c=+s.data[4],l=+s.data[5];t&&(a+=e.x,o+=e.x,c+=e.x,f+=e.y,n+=e.y,l+=e.y);const r=this._bezierTo(a,f,o,n,c,l,e,h);i=i.concat(r),e.bezierReflectionPoint=[c+(c-o),l+(l-n)]}break}case"S":case"s":{const t="s"===s.key;if(s.data.length>=4){let f=+s.data[0],o=+s.data[1],n=+s.data[2],c=+s.data[3];t&&(f+=e.x,n+=e.x,o+=e.y,c+=e.y);let l=f,r=o;const g=a?a.key:"";let u=null;"c"!==g&&"C"!==g&&"s"!==g&&"S"!==g||(u=e.bezierReflectionPoint),u&&(l=u[0],r=u[1]);const p=this._bezierTo(l,r,f,o,n,c,e,h);i=i.concat(p),e.bezierReflectionPoint=[n+(n-f),c+(c-o)]}break}case"Q":case"q":{const t="q"===s.key;if(s.data.length>=4){let a=+s.data[0],f=+s.data[1],o=+s.data[2],n=+s.data[3];t&&(a+=e.x,o+=e.x,f+=e.y,n+=e.y);const c=1*(1+.2*h.roughness),l=1.5*(1+.22*h.roughness);i.push({op:"move",data:[e.x+this.getOffset(-c,c,h),e.y+this.getOffset(-c,c,h)]});let r=[o+this.getOffset(-c,c,h),n+this.getOffset(-c,c,h)];i.push({op:"qcurveTo",data:[a+this.getOffset(-c,c,h),f+this.getOffset(-c,c,h),r[0],r[1]]}),i.push({op:"move",data:[e.x+this.getOffset(-l,l,h),e.y+this.getOffset(-l,l,h)]}),r=[o+this.getOffset(-l,l,h),n+this.getOffset(-l,l,h)],i.push({op:"qcurveTo",data:[a+this.getOffset(-l,l,h),f+this.getOffset(-l,l,h),r[0],r[1]]}),e.setPosition(r[0],r[1]),e.quadReflectionPoint=[o+(o-a),n+(n-f)]}break}case"T":case"t":{const t="t"===s.key;if(s.data.length>=2){let f=+s.data[0],o=+s.data[1];t&&(f+=e.x,o+=e.y);let n=f,c=o;const l=a?a.key:"";let r=null;"q"!==l&&"Q"!==l&&"t"!==l&&"T"!==l||(r=e.quadReflectionPoint),r&&(n=r[0],c=r[1]);const g=1*(1+.2*h.roughness),u=1.5*(1+.22*h.roughness);i.push({op:"move",data:[e.x+this.getOffset(-g,g,h),e.y+this.getOffset(-g,g,h)]});let p=[f+this.getOffset(-g,g,h),o+this.getOffset(-g,g,h)];i.push({op:"qcurveTo",data:[n+this.getOffset(-g,g,h),c+this.getOffset(-g,g,h),p[0],p[1]]}),i.push({op:"move",data:[e.x+this.getOffset(-u,u,h),e.y+this.getOffset(-u,u,h)]}),p=[f+this.getOffset(-u,u,h),o+this.getOffset(-u,u,h)],i.push({op:"qcurveTo",data:[n+this.getOffset(-u,u,h),c+this.getOffset(-u,u,h),p[0],p[1]]}),e.setPosition(p[0],p[1]),e.quadReflectionPoint=[f+(f-n),o+(o-c)]}break}case"A":case"a":{const a="a"===s.key;if(s.data.length>=7){const f=+s.data[0],o=+s.data[1],n=+s.data[2],c=+s.data[3],l=+s.data[4];let r=+s.data[5],g=+s.data[6];if(a&&(r+=e.x,g+=e.y),r===e.x&&g===e.y)break;if(0===f||0===o)i=i.concat(this.doubleLine(e.x,e.y,r,g,h)),e.setPosition(r,g);else for(let s=0;s<1;s++){const s=new t.RoughArcConverter([e.x,e.y],[r,g],[f,o],n,!!c,!!l);let a=s.getNextSegment();for(;a;){const t=this._bezierTo(a.cp1[0],a.cp1[1],a.cp2[0],a.cp2[1],a.to[0],a.to[1],e,h);i=i.concat(t),a=s.getNextSegment()}}}break}}return i}}exports.RoughRenderer=s;
},{"./path.js":"6dwr","./fillers/filler":"L90K"}],"tr6r":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.createRenderer=n;var e=require("./renderer");const r="undefined"!=typeof self,t=r&&self&&self.document&&self.document.currentScript&&self.document.currentScript.src;function n(n){if(r&&t&&self&&self.workly&&n.async&&!n.noWorker){const e=n.worklyURL||"https://cdn.jsdelivr.net/gh/pshihn/workly/dist/workly.min.js";if(e){const r=`importScripts('${e}', '${t}');\nworkly.expose(self.rough.createRenderer());`,n=URL.createObjectURL(new Blob([r]));return self.workly.proxy(n)}}return new e.RoughRenderer}
},{"./renderer":"1NlH"}],"mEKd":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RoughGeneratorBase=void 0;var t=require("./renderer-factory.js");const e="undefined"!=typeof self;class s{constructor(e,s){this.defaultOptions={maxRandomnessOffset:2,roughness:1,bowing:1,stroke:"#000",strokeWidth:1,curveTightness:0,curveStepCount:9,fillStyle:"hachure",fillWeight:-1,hachureAngle:-41,hachureGap:-1},this.config=e||{},this.surface=s,this.renderer=(0,t.createRenderer)(this.config),this.config.options&&(this.defaultOptions=this._options(this.config.options))}_options(t){return t?Object.assign({},this.defaultOptions,t):this.defaultOptions}_drawable(t,e,s){return{shape:t,sets:e||[],options:s||this.defaultOptions}}get lib(){return this.renderer}getCanvasSize(){const t=t=>t&&"object"==typeof t&&t.baseVal&&t.baseVal.value?t.baseVal.value:t||100;return this.surface?[t(this.surface.width),t(this.surface.height)]:[100,100]}computePolygonSize(t){if(t.length){let e=t[0][0],s=t[0][0],o=t[0][1],i=t[0][1];for(let r=1;r<t.length;r++)e=Math.min(e,t[r][0]),s=Math.max(s,t[r][0]),o=Math.min(o,t[r][1]),i=Math.max(i,t[r][1]);return[s-e,i-o]}return[0,0]}polygonPath(t){let e="";if(t.length){e=`M${t[0][0]},${t[0][1]}`;for(let s=1;s<t.length;s++)e=`${e} L${t[s][0]},${t[s][1]}`}return e}computePathSize(t){let s=[0,0];if(e&&self.document)try{const e="http://www.w3.org/2000/svg",o=self.document.createElementNS(e,"svg");o.setAttribute("width","0"),o.setAttribute("height","0");const i=self.document.createElementNS(e,"path");i.setAttribute("d",t),o.appendChild(i),self.document.body.appendChild(o);const r=i.getBBox();r&&(s[0]=r.width||0,s[1]=r.height||0),self.document.body.removeChild(o)}catch(t){}const o=this.getCanvasSize();return s[0]*s[1]||(s=o),s}toPaths(t){const e=t.sets||[],s=t.options||this.defaultOptions,o=[];for(const t of e){let e=null;switch(t.type){case"path":e={d:this.opsToPath(t),stroke:s.stroke,strokeWidth:s.strokeWidth,fill:"none"};break;case"fillPath":e={d:this.opsToPath(t),stroke:"none",strokeWidth:0,fill:s.fill||"none"};break;case"fillSketch":e=this.fillSketch(t,s);break;case"path2Dfill":e={d:t.path||"",stroke:"none",strokeWidth:0,fill:s.fill||"none"};break;case"path2Dpattern":{const o=t.size,i={x:0,y:0,width:1,height:1,viewBox:`0 0 ${Math.round(o[0])} ${Math.round(o[1])}`,patternUnits:"objectBoundingBox",path:this.fillSketch(t,s)};e={d:t.path,stroke:"none",strokeWidth:0,pattern:i};break}}e&&o.push(e)}return o}fillSketch(t,e){let s=e.fillWeight;return s<0&&(s=e.strokeWidth/2),{d:this.opsToPath(t),stroke:e.fill||"none",strokeWidth:s,fill:"none"}}opsToPath(t){let e="";for(const s of t.ops){const t=s.data;switch(s.op){case"move":e+=`M${t[0]} ${t[1]} `;break;case"bcurveTo":e+=`C${t[0]} ${t[1]}, ${t[2]} ${t[3]}, ${t[4]} ${t[5]} `;break;case"qcurveTo":e+=`Q${t[0]} ${t[1]}, ${t[2]} ${t[3]} `;break;case"lineTo":e+=`L${t[0]} ${t[1]} `}}return e.trim()}}exports.RoughGeneratorBase=s;
},{"./renderer-factory.js":"tr6r"}],"5mwZ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RoughGenerator=void 0;var t=require("./generator-base");class i extends t.RoughGeneratorBase{constructor(t,i){super(t,i)}line(t,i,l,s,e){const h=this._options(e);return this._drawable("line",[this.lib.line(t,i,l,s,h)],h)}rectangle(t,i,l,s,e){const h=this._options(e),o=[];if(h.fill){const e=[[t,i],[t+l,i],[t+l,i+s],[t,i+s]];"solid"===h.fillStyle?o.push(this.lib.solidFillPolygon(e,h)):o.push(this.lib.patternFillPolygon(e,h))}return o.push(this.lib.rectangle(t,i,l,s,h)),this._drawable("rectangle",o,h)}ellipse(t,i,l,s,e){const h=this._options(e),o=[];if(h.fill)if("solid"===h.fillStyle){const e=this.lib.ellipse(t,i,l,s,h);e.type="fillPath",o.push(e)}else o.push(this.lib.patternFillEllipse(t,i,l,s,h));return o.push(this.lib.ellipse(t,i,l,s,h)),this._drawable("ellipse",o,h)}circle(t,i,l,s){const e=this.ellipse(t,i,l,l,s);return e.shape="circle",e}linearPath(t,i){const l=this._options(i);return this._drawable("linearPath",[this.lib.linearPath(t,!1,l)],l)}arc(t,i,l,s,e,h,o=!1,r){const n=this._options(r),a=[];if(o&&n.fill)if("solid"===n.fillStyle){const o=this.lib.arc(t,i,l,s,e,h,!0,!1,n);o.type="fillPath",a.push(o)}else a.push(this.lib.patternFillArc(t,i,l,s,e,h,n));return a.push(this.lib.arc(t,i,l,s,e,h,o,!0,n)),this._drawable("arc",a,n)}curve(t,i){const l=this._options(i);return this._drawable("curve",[this.lib.curve(t,l)],l)}polygon(t,i){const l=this._options(i),s=[];if(l.fill)if("solid"===l.fillStyle)s.push(this.lib.solidFillPolygon(t,l));else{const i=this.computePolygonSize(t),e=[[0,0],[i[0],0],[i[0],i[1]],[0,i[1]]],h=this.lib.patternFillPolygon(e,l);h.type="path2Dpattern",h.size=i,h.path=this.polygonPath(t),s.push(h)}return s.push(this.lib.linearPath(t,!0,l)),this._drawable("polygon",s,l)}path(t,i){const l=this._options(i),s=[];if(!t)return this._drawable("path",s,l);if(l.fill)if("solid"===l.fillStyle){const i={type:"path2Dfill",path:t,ops:[]};s.push(i)}else{const i=this.computePathSize(t),e=[[0,0],[i[0],0],[i[0],i[1]],[0,i[1]]],h=this.lib.patternFillPolygon(e,l);h.type="path2Dpattern",h.size=i,h.path=t,s.push(h)}return s.push(this.lib.svgPath(t,l)),this._drawable("path",s,l)}}exports.RoughGenerator=i;
},{"./generator-base":"mEKd"}],"c7kZ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RoughCanvasBase=void 0;var t=require("./renderer");const e="undefined"!=typeof document;class s{constructor(t){this.canvas=t,this.ctx=this.canvas.getContext("2d")}static createRenderer(){return new t.RoughRenderer}draw(t){const s=t.sets||[],o=t.options||this.getDefaultOptions(),r=this.ctx;for(const t of s)switch(t.type){case"path":r.save(),r.strokeStyle=o.stroke,r.lineWidth=o.strokeWidth,this._drawToContext(r,t),r.restore();break;case"fillPath":r.save(),r.fillStyle=o.fill||"",this._drawToContext(r,t),r.restore();break;case"fillSketch":this.fillSketch(r,t,o);break;case"path2Dfill":{this.ctx.save(),this.ctx.fillStyle=o.fill||"";const e=new Path2D(t.path);this.ctx.fill(e),this.ctx.restore();break}case"path2Dpattern":{const s=this.canvas.ownerDocument||e&&document;if(s){const e=t.size,r=s.createElement("canvas"),a=r.getContext("2d"),i=this.computeBBox(t.path);i&&(i.width||i.height)?(r.width=this.canvas.width,r.height=this.canvas.height,a.translate(i.x||0,i.y||0)):(r.width=e[0],r.height=e[1]),this.fillSketch(a,t,o),this.ctx.save(),this.ctx.fillStyle=this.ctx.createPattern(r,"repeat");const c=new Path2D(t.path);this.ctx.fill(c),this.ctx.restore()}else console.error("Cannot render path2Dpattern. No defs/document defined.");break}}}computeBBox(t){if(e)try{const e="http://www.w3.org/2000/svg",s=document.createElementNS(e,"svg");s.setAttribute("width","0"),s.setAttribute("height","0");const o=self.document.createElementNS(e,"path");o.setAttribute("d",t),s.appendChild(o),document.body.appendChild(s);const r=o.getBBox();return document.body.removeChild(s),r}catch(t){}return null}fillSketch(t,e,s){let o=s.fillWeight;o<0&&(o=s.strokeWidth/2),t.save(),t.strokeStyle=s.fill||"",t.lineWidth=o,this._drawToContext(t,e),t.restore()}_drawToContext(t,e){t.beginPath();for(const s of e.ops){const e=s.data;switch(s.op){case"move":t.moveTo(e[0],e[1]);break;case"bcurveTo":t.bezierCurveTo(e[0],e[1],e[2],e[3],e[4],e[5]);break;case"qcurveTo":t.quadraticCurveTo(e[0],e[1],e[2],e[3]);break;case"lineTo":t.lineTo(e[0],e[1])}}"fillPath"===e.type?t.fill():t.stroke()}}exports.RoughCanvasBase=s;
},{"./renderer":"1NlH"}],"XUb1":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RoughCanvas=void 0;var e=require("./generator"),t=require("./canvas-base");class r extends t.RoughCanvasBase{constructor(t,r){super(t),this.gen=new e.RoughGenerator(r||null,this.canvas)}get generator(){return this.gen}getDefaultOptions(){return this.gen.defaultOptions}line(e,t,r,n,s){const a=this.gen.line(e,t,r,n,s);return this.draw(a),a}rectangle(e,t,r,n,s){const a=this.gen.rectangle(e,t,r,n,s);return this.draw(a),a}ellipse(e,t,r,n,s){const a=this.gen.ellipse(e,t,r,n,s);return this.draw(a),a}circle(e,t,r,n){const s=this.gen.circle(e,t,r,n);return this.draw(s),s}linearPath(e,t){const r=this.gen.linearPath(e,t);return this.draw(r),r}polygon(e,t){const r=this.gen.polygon(e,t);return this.draw(r),r}arc(e,t,r,n,s,a,i=!1,h){const o=this.gen.arc(e,t,r,n,s,a,i,h);return this.draw(o),o}curve(e,t){const r=this.gen.curve(e,t);return this.draw(r),r}path(e,t){const r=this.gen.path(e,t);return this.draw(r),r}}exports.RoughCanvas=r;
},{"./generator":"5mwZ","./canvas-base":"c7kZ"}],"FaN9":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RoughGeneratorAsync=void 0;var t=require("./generator-base");class i extends t.RoughGeneratorBase{async line(t,i,s,l,a){const e=this._options(a);return this._drawable("line",[await this.lib.line(t,i,s,l,e)],e)}async rectangle(t,i,s,l,a){const e=this._options(a),n=[];if(e.fill){const a=[[t,i],[t+s,i],[t+s,i+l],[t,i+l]];"solid"===e.fillStyle?n.push(await this.lib.solidFillPolygon(a,e)):n.push(await this.lib.patternFillPolygon(a,e))}return n.push(await this.lib.rectangle(t,i,s,l,e)),this._drawable("rectangle",n,e)}async ellipse(t,i,s,l,a){const e=this._options(a),n=[];if(e.fill)if("solid"===e.fillStyle){const a=await this.lib.ellipse(t,i,s,l,e);a.type="fillPath",n.push(a)}else n.push(await this.lib.patternFillEllipse(t,i,s,l,e));return n.push(await this.lib.ellipse(t,i,s,l,e)),this._drawable("ellipse",n,e)}async circle(t,i,s,l){const a=await this.ellipse(t,i,s,s,l);return a.shape="circle",a}async linearPath(t,i){const s=this._options(i);return this._drawable("linearPath",[await this.lib.linearPath(t,!1,s)],s)}async arc(t,i,s,l,a,e,n=!1,h){const o=this._options(h),r=[];if(n&&o.fill)if("solid"===o.fillStyle){const n=await this.lib.arc(t,i,s,l,a,e,!0,!1,o);n.type="fillPath",r.push(n)}else r.push(await this.lib.patternFillArc(t,i,s,l,a,e,o));return r.push(await this.lib.arc(t,i,s,l,a,e,n,!0,o)),this._drawable("arc",r,o)}async curve(t,i){const s=this._options(i);return this._drawable("curve",[await this.lib.curve(t,s)],s)}async polygon(t,i){const s=this._options(i),l=[];if(s.fill)if("solid"===s.fillStyle)l.push(await this.lib.solidFillPolygon(t,s));else{const i=this.computePolygonSize(t),a=[[0,0],[i[0],0],[i[0],i[1]],[0,i[1]]],e=await this.lib.patternFillPolygon(a,s);e.type="path2Dpattern",e.size=i,e.path=this.polygonPath(t),l.push(e)}return l.push(await this.lib.linearPath(t,!0,s)),this._drawable("polygon",l,s)}async path(t,i){const s=this._options(i),l=[];if(!t)return this._drawable("path",l,s);if(s.fill)if("solid"===s.fillStyle){const i={type:"path2Dfill",path:t,ops:[]};l.push(i)}else{const i=this.computePathSize(t),a=[[0,0],[i[0],0],[i[0],i[1]],[0,i[1]]],e=await this.lib.patternFillPolygon(a,s);e.type="path2Dpattern",e.size=i,e.path=t,l.push(e)}return l.push(await this.lib.svgPath(t,s)),this._drawable("path",l,s)}}exports.RoughGeneratorAsync=i;
},{"./generator-base":"mEKd"}],"uc/h":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RoughCanvasAsync=void 0;var n=require("./generator-async"),s=require("./canvas-base");class t extends s.RoughCanvasBase{constructor(s,t){super(s),this.genAsync=new n.RoughGeneratorAsync(t||null,this.canvas)}get generator(){return this.genAsync}getDefaultOptions(){return this.genAsync.defaultOptions}async line(n,s,t,e,a){const r=await this.genAsync.line(n,s,t,e,a);return this.draw(r),r}async rectangle(n,s,t,e,a){const r=await this.genAsync.rectangle(n,s,t,e,a);return this.draw(r),r}async ellipse(n,s,t,e,a){const r=await this.genAsync.ellipse(n,s,t,e,a);return this.draw(r),r}async circle(n,s,t,e){const a=await this.genAsync.circle(n,s,t,e);return this.draw(a),a}async linearPath(n,s){const t=await this.genAsync.linearPath(n,s);return this.draw(t),t}async polygon(n,s){const t=await this.genAsync.polygon(n,s);return this.draw(t),t}async arc(n,s,t,e,a,r,c=!1,i){const h=await this.genAsync.arc(n,s,t,e,a,r,c,i);return this.draw(h),h}async curve(n,s){const t=await this.genAsync.curve(n,s);return this.draw(t),t}async path(n,s){const t=await this.genAsync.path(n,s);return this.draw(t),t}}exports.RoughCanvasAsync=t;
},{"./generator-async":"FaN9","./canvas-base":"c7kZ"}],"qCgU":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RoughSVGBase=void 0;var t=require("./renderer");const e="undefined"!=typeof document;class s{constructor(t){this.svg=t}static createRenderer(){return new t.RoughRenderer}get defs(){const t=this.svg.ownerDocument||e&&document;if(t&&!this._defs){const e=t.createElementNS("http://www.w3.org/2000/svg","defs");this.svg.firstChild?this.svg.insertBefore(e,this.svg.firstChild):this.svg.appendChild(e),this._defs=e}return this._defs||null}draw(t){const s=t.sets||[],r=t.options||this.getDefaultOptions(),i=this.svg.ownerDocument||e&&document,o=i.createElementNS("http://www.w3.org/2000/svg","g");for(const t of s){let e=null;switch(t.type){case"path":(e=i.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("d",this.opsToPath(t)),e.style.stroke=r.stroke,e.style.strokeWidth=r.strokeWidth+"",e.style.fill="none";break;case"fillPath":(e=i.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("d",this.opsToPath(t)),e.style.stroke="none",e.style.strokeWidth="0",e.style.fill=r.fill||null;break;case"fillSketch":e=this.fillSketch(i,t,r);break;case"path2Dfill":(e=i.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("d",t.path||""),e.style.stroke="none",e.style.strokeWidth="0",e.style.fill=r.fill||null;break;case"path2Dpattern":if(this.defs){const s=t.size,o=i.createElementNS("http://www.w3.org/2000/svg","pattern"),l=`rough-${Math.floor(Math.random()*(Number.MAX_SAFE_INTEGER||999999))}`;o.setAttribute("id",l),o.setAttribute("x","0"),o.setAttribute("y","0"),o.setAttribute("width","1"),o.setAttribute("height","1"),o.setAttribute("height","1"),o.setAttribute("viewBox",`0 0 ${Math.round(s[0])} ${Math.round(s[1])}`),o.setAttribute("patternUnits","objectBoundingBox");const h=this.fillSketch(i,t,r);o.appendChild(h),this.defs.appendChild(o),(e=i.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("d",t.path||""),e.style.stroke="none",e.style.strokeWidth="0",e.style.fill=`url(#${l})`}else console.error("Cannot render path2Dpattern. No defs/document defined.")}e&&o.appendChild(e)}return o}fillSketch(t,e,s){let r=s.fillWeight;r<0&&(r=s.strokeWidth/2);const i=t.createElementNS("http://www.w3.org/2000/svg","path");return i.setAttribute("d",this.opsToPath(e)),i.style.stroke=s.fill||null,i.style.strokeWidth=r+"",i.style.fill="none",i}}exports.RoughSVGBase=s;
},{"./renderer":"1NlH"}],"rSyH":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RoughSVG=void 0;var e=require("./generator"),t=require("./svg-base");class r extends t.RoughSVGBase{constructor(t,r){super(t),this.gen=new e.RoughGenerator(r||null,this.svg)}get generator(){return this.gen}getDefaultOptions(){return this.gen.defaultOptions}opsToPath(e){return this.gen.opsToPath(e)}line(e,t,r,s,n){const i=this.gen.line(e,t,r,s,n);return this.draw(i)}rectangle(e,t,r,s,n){const i=this.gen.rectangle(e,t,r,s,n);return this.draw(i)}ellipse(e,t,r,s,n){const i=this.gen.ellipse(e,t,r,s,n);return this.draw(i)}circle(e,t,r,s){const n=this.gen.circle(e,t,r,s);return this.draw(n)}linearPath(e,t){const r=this.gen.linearPath(e,t);return this.draw(r)}polygon(e,t){const r=this.gen.polygon(e,t);return this.draw(r)}arc(e,t,r,s,n,i,o=!1,h){const a=this.gen.arc(e,t,r,s,n,i,o,h);return this.draw(a)}curve(e,t){const r=this.gen.curve(e,t);return this.draw(r)}path(e,t){const r=this.gen.path(e,t);return this.draw(r)}}exports.RoughSVG=r;
},{"./generator":"5mwZ","./svg-base":"qCgU"}],"xMHo":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RoughSVGAsync=void 0;var t=require("./generator-async"),s=require("./svg-base");class n extends s.RoughSVGBase{constructor(s,n){super(s),this.genAsync=new t.RoughGeneratorAsync(n||null,this.svg)}get generator(){return this.genAsync}getDefaultOptions(){return this.genAsync.defaultOptions}opsToPath(t){return this.genAsync.opsToPath(t)}async line(t,s,n,e,r){const a=await this.genAsync.line(t,s,n,e,r);return this.draw(a)}async rectangle(t,s,n,e,r){const a=await this.genAsync.rectangle(t,s,n,e,r);return this.draw(a)}async ellipse(t,s,n,e,r){const a=await this.genAsync.ellipse(t,s,n,e,r);return this.draw(a)}async circle(t,s,n,e){const r=await this.genAsync.circle(t,s,n,e);return this.draw(r)}async linearPath(t,s){const n=await this.genAsync.linearPath(t,s);return this.draw(n)}async polygon(t,s){const n=await this.genAsync.polygon(t,s);return this.draw(n)}async arc(t,s,n,e,r,a,c=!1,i){const o=await this.genAsync.arc(t,s,n,e,r,a,c,i);return this.draw(o)}async curve(t,s){const n=await this.genAsync.curve(t,s);return this.draw(n)}async path(t,s){const n=await this.genAsync.path(t,s);return this.draw(n)}}exports.RoughSVGAsync=n;
},{"./generator-async":"FaN9","./svg-base":"qCgU"}],"K/JU":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./canvas"),r=require("./generator"),n=require("./generator-async"),a=require("./canvas-async"),s=require("./svg"),u=require("./svg-async");exports.default={canvas:(r,n)=>n&&n.async?new a.RoughCanvasAsync(r,n):new e.RoughCanvas(r,n),svg:(e,r)=>r&&r.async?new u.RoughSVGAsync(e,r):new s.RoughSVG(e,r),createRenderer:()=>e.RoughCanvas.createRenderer(),generator:(e,a)=>e&&e.async?new n.RoughGeneratorAsync(e,a):new r.RoughGenerator(e,a)};
},{"./canvas":"XUb1","./generator":"5mwZ","./generator-async":"FaN9","./canvas-async":"uc/h","./svg":"rSyH","./svg-async":"xMHo"}],"rwa0":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("roughjs"),t=i(e);function i(e){return e&&e.__esModule?e:{default:e}}function n(){this.createAndAppend=function(e){this.element=document.createElement("canvas"),e.appendChild(this.element),this.context2d=this.element.getContext("2d"),this.roughCanvas=t.default.canvas(this.element)},this.resize=function(e){this.element.width=e.width,this.element.height=e.height},this.getSize=function(){return{width:this.element.width,height:this.element.height}},this.clear=function(){this.context2d.clearRect(0,0,this.element.width,this.element.height)},this.element=null,this.context2d=null,this.roughCanvas=null}exports.default=n;
},{"roughjs":"K/JU"}],"X+cO":[function(require,module,exports) {
var e={};e.useBlobBuilder=function(){try{return new Blob([]),!1}catch(e){return!0}}(),e.useArrayBufferView=!e.useBlobBuilder&&function(){try{return 0===new Blob([new Uint8Array([])]).size}catch(e){return!0}}(),module.exports.binaryFeatures=e;var r=module.exports.BlobBuilder;function t(){this._pieces=[],this._parts=[]}"undefined"!=typeof window&&(r=module.exports.BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder),t.prototype.append=function(e){"number"==typeof e?this._pieces.push(e):(this.flush(),this._parts.push(e))},t.prototype.flush=function(){if(this._pieces.length>0){var r=new Uint8Array(this._pieces);e.useArrayBufferView||(r=r.buffer),this._parts.push(r),this._pieces=[]}},t.prototype.getBuffer=function(){if(this.flush(),e.useBlobBuilder){for(var t=new r,i=0,u=this._parts.length;i<u;i++)t.append(this._parts[i]);return t.getBlob()}return new Blob(this._parts)},module.exports.BufferBuilder=t;
},{}],"J6D+":[function(require,module,exports) {
var t=require("./bufferbuilder").BufferBuilder,e=require("./bufferbuilder").binaryFeatures,i={unpack:function(t){return new r(t).unpack()},pack:function(t){var e=new n;return e.pack(t),e.getBuffer()}};function r(t){this.index=0,this.dataBuffer=t,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}function n(){this.bufferBuilder=new t}function u(t){var e=t.charCodeAt(0);return e<=2047?"00":e<=65535?"000":e<=2097151?"0000":e<=67108863?"00000":"000000"}function a(t){return t.length>600?new Blob([t]).size:t.replace(/[^\u0000-\u007F]/g,u).length}module.exports=i,r.prototype.unpack=function(){var t,e=this.unpack_uint8();if(e<128)return e;if((224^e)<32)return(224^e)-32;if((t=160^e)<=15)return this.unpack_raw(t);if((t=176^e)<=15)return this.unpack_string(t);if((t=144^e)<=15)return this.unpack_array(t);if((t=128^e)<=15)return this.unpack_map(t);switch(e){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:case 213:case 214:case 215:return;case 216:return t=this.unpack_uint16(),this.unpack_string(t);case 217:return t=this.unpack_uint32(),this.unpack_string(t);case 218:return t=this.unpack_uint16(),this.unpack_raw(t);case 219:return t=this.unpack_uint32(),this.unpack_raw(t);case 220:return t=this.unpack_uint16(),this.unpack_array(t);case 221:return t=this.unpack_uint32(),this.unpack_array(t);case 222:return t=this.unpack_uint16(),this.unpack_map(t);case 223:return t=this.unpack_uint32(),this.unpack_map(t)}},r.prototype.unpack_uint8=function(){var t=255&this.dataView[this.index];return this.index++,t},r.prototype.unpack_uint16=function(){var t=this.read(2),e=256*(255&t[0])+(255&t[1]);return this.index+=2,e},r.prototype.unpack_uint32=function(){var t=this.read(4),e=256*(256*(256*t[0]+t[1])+t[2])+t[3];return this.index+=4,e},r.prototype.unpack_uint64=function(){var t=this.read(8),e=256*(256*(256*(256*(256*(256*(256*t[0]+t[1])+t[2])+t[3])+t[4])+t[5])+t[6])+t[7];return this.index+=8,e},r.prototype.unpack_int8=function(){var t=this.unpack_uint8();return t<128?t:t-256},r.prototype.unpack_int16=function(){var t=this.unpack_uint16();return t<32768?t:t-65536},r.prototype.unpack_int32=function(){var t=this.unpack_uint32();return t<Math.pow(2,31)?t:t-Math.pow(2,32)},r.prototype.unpack_int64=function(){var t=this.unpack_uint64();return t<Math.pow(2,63)?t:t-Math.pow(2,64)},r.prototype.unpack_raw=function(t){if(this.length<this.index+t)throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+t+" "+this.length);var e=this.dataBuffer.slice(this.index,this.index+t);return this.index+=t,e},r.prototype.unpack_string=function(t){for(var e,i,r=this.read(t),n=0,u="";n<t;)(e=r[n])<128?(u+=String.fromCharCode(e),n++):(192^e)<32?(i=(192^e)<<6|63&r[n+1],u+=String.fromCharCode(i),n+=2):(i=(15&e)<<12|(63&r[n+1])<<6|63&r[n+2],u+=String.fromCharCode(i),n+=3);return this.index+=t,u},r.prototype.unpack_array=function(t){for(var e=new Array(t),i=0;i<t;i++)e[i]=this.unpack();return e},r.prototype.unpack_map=function(t){for(var e={},i=0;i<t;i++){var r=this.unpack(),n=this.unpack();e[r]=n}return e},r.prototype.unpack_float=function(){var t=this.unpack_uint32(),e=(t>>23&255)-127;return(0==t>>31?1:-1)*(8388607&t|8388608)*Math.pow(2,e-23)},r.prototype.unpack_double=function(){var t=this.unpack_uint32(),e=this.unpack_uint32(),i=(t>>20&2047)-1023;return(0==t>>31?1:-1)*((1048575&t|1048576)*Math.pow(2,i-20)+e*Math.pow(2,i-52))},r.prototype.read=function(t){var e=this.index;if(e+t<=this.length)return this.dataView.subarray(e,e+t);throw new Error("BinaryPackFailure: read index out of range")},n.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()},n.prototype.pack=function(t){var i=typeof t;if("string"==i)this.pack_string(t);else if("number"==i)Math.floor(t)===t?this.pack_integer(t):this.pack_double(t);else if("boolean"==i)!0===t?this.bufferBuilder.append(195):!1===t&&this.bufferBuilder.append(194);else if("undefined"==i)this.bufferBuilder.append(192);else{if("object"!=i)throw new Error('Type "'+i+'" not yet supported');if(null===t)this.bufferBuilder.append(192);else{var r=t.constructor;if(r==Array)this.pack_array(t);else if(r==Blob||r==File)this.pack_bin(t);else if(r==ArrayBuffer)e.useArrayBufferView?this.pack_bin(new Uint8Array(t)):this.pack_bin(t);else if("BYTES_PER_ELEMENT"in t)e.useArrayBufferView?this.pack_bin(new Uint8Array(t.buffer)):this.pack_bin(t.buffer);else if(r==Object)this.pack_object(t);else if(r==Date)this.pack_string(t.toString());else{if("function"!=typeof t.toBinaryPack)throw new Error('Type "'+r.toString()+'" not yet supported');this.bufferBuilder.append(t.toBinaryPack())}}}this.bufferBuilder.flush()},n.prototype.pack_bin=function(t){var e=t.length||t.byteLength||t.size;if(e<=15)this.pack_uint8(160+e);else if(e<=65535)this.bufferBuilder.append(218),this.pack_uint16(e);else{if(!(e<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(219),this.pack_uint32(e)}this.bufferBuilder.append(t)},n.prototype.pack_string=function(t){var e=a(t);if(e<=15)this.pack_uint8(176+e);else if(e<=65535)this.bufferBuilder.append(216),this.pack_uint16(e);else{if(!(e<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(217),this.pack_uint32(e)}this.bufferBuilder.append(t)},n.prototype.pack_array=function(t){var e=t.length;if(e<=15)this.pack_uint8(144+e);else if(e<=65535)this.bufferBuilder.append(220),this.pack_uint16(e);else{if(!(e<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(221),this.pack_uint32(e)}for(var i=0;i<e;i++)this.pack(t[i])},n.prototype.pack_integer=function(t){if(-32<=t&&t<=127)this.bufferBuilder.append(255&t);else if(0<=t&&t<=255)this.bufferBuilder.append(204),this.pack_uint8(t);else if(-128<=t&&t<=127)this.bufferBuilder.append(208),this.pack_int8(t);else if(0<=t&&t<=65535)this.bufferBuilder.append(205),this.pack_uint16(t);else if(-32768<=t&&t<=32767)this.bufferBuilder.append(209),this.pack_int16(t);else if(0<=t&&t<=4294967295)this.bufferBuilder.append(206),this.pack_uint32(t);else if(-2147483648<=t&&t<=2147483647)this.bufferBuilder.append(210),this.pack_int32(t);else if(-0x8000000000000000<=t&&t<=0x8000000000000000)this.bufferBuilder.append(211),this.pack_int64(t);else{if(!(0<=t&&t<=0x10000000000000000))throw new Error("Invalid integer");this.bufferBuilder.append(207),this.pack_uint64(t)}},n.prototype.pack_double=function(t){var e=0;t<0&&(e=1,t=-t);var i=Math.floor(Math.log(t)/Math.LN2),r=t/Math.pow(2,i)-1,n=Math.floor(r*Math.pow(2,52)),u=Math.pow(2,32),a=e<<31|i+1023<<20|n/u&1048575,p=n%u;this.bufferBuilder.append(203),this.pack_int32(a),this.pack_int32(p)},n.prototype.pack_object=function(t){var e=Object.keys(t).length;if(e<=15)this.pack_uint8(128+e);else if(e<=65535)this.bufferBuilder.append(222),this.pack_uint16(e);else{if(!(e<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(223),this.pack_uint32(e)}for(var i in t)t.hasOwnProperty(i)&&(this.pack(i),this.pack(t[i]))},n.prototype.pack_uint8=function(t){this.bufferBuilder.append(t)},n.prototype.pack_uint16=function(t){this.bufferBuilder.append(t>>8),this.bufferBuilder.append(255&t)},n.prototype.pack_uint32=function(t){var e=4294967295&t;this.bufferBuilder.append((4278190080&e)>>>24),this.bufferBuilder.append((16711680&e)>>>16),this.bufferBuilder.append((65280&e)>>>8),this.bufferBuilder.append(255&e)},n.prototype.pack_uint64=function(t){var e=t/Math.pow(2,32),i=t%Math.pow(2,32);this.bufferBuilder.append((4278190080&e)>>>24),this.bufferBuilder.append((16711680&e)>>>16),this.bufferBuilder.append((65280&e)>>>8),this.bufferBuilder.append(255&e),this.bufferBuilder.append((4278190080&i)>>>24),this.bufferBuilder.append((16711680&i)>>>16),this.bufferBuilder.append((65280&i)>>>8),this.bufferBuilder.append(255&i)},n.prototype.pack_int8=function(t){this.bufferBuilder.append(255&t)},n.prototype.pack_int16=function(t){this.bufferBuilder.append((65280&t)>>8),this.bufferBuilder.append(255&t)},n.prototype.pack_int32=function(t){this.bufferBuilder.append(t>>>24&255),this.bufferBuilder.append((16711680&t)>>>16),this.bufferBuilder.append((65280&t)>>>8),this.bufferBuilder.append(255&t)},n.prototype.pack_int64=function(t){var e=Math.floor(t/Math.pow(2,32)),i=t%Math.pow(2,32);this.bufferBuilder.append((4278190080&e)>>>24),this.bufferBuilder.append((16711680&e)>>>16),this.bufferBuilder.append((65280&e)>>>8),this.bufferBuilder.append(255&e),this.bufferBuilder.append((4278190080&i)>>>24),this.bufferBuilder.append((16711680&i)>>>16),this.bufferBuilder.append((65280&i)>>>8),this.bufferBuilder.append(255&i)};
},{"./bufferbuilder":"X+cO"}],"4DZb":[function(require,module,exports) {
module.exports.RTCSessionDescription=window.RTCSessionDescription||window.mozRTCSessionDescription,module.exports.RTCPeerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,module.exports.RTCIceCandidate=window.RTCIceCandidate||window.mozRTCIceCandidate;
},{}],"zQTp":[function(require,module,exports) {
var global = arguments[3];
var e=arguments[3],n={iceServers:[{url:"stun:stun.l.google.com:19302"}]},r=1,o=require("js-binarypack"),t=require("./adapter").RTCPeerConnection,a={noop:function(){},CLOUD_HOST:"0.peerjs.com",CLOUD_PORT:9e3,chunkedBrowsers:{Chrome:1},chunkedMTU:16300,logLevel:0,setLogLevel:function(e){var n=parseInt(e,10);isNaN(parseInt(e,10))?a.logLevel=e?3:0:a.logLevel=n,a.log=a.warn=a.error=a.noop,a.logLevel>0&&(a.error=a._printWith("ERROR")),a.logLevel>1&&(a.warn=a._printWith("WARNING")),a.logLevel>2&&(a.log=a._print)},setLogFunction:function(e){e.constructor!==Function?a.warn("The log function you passed in is not a function. Defaulting to regular logs."):a._print=e},_printWith:function(e){return function(){var n=Array.prototype.slice.call(arguments);n.unshift(e),a._print.apply(a,n)}},_print:function(){var e=!1,n=Array.prototype.slice.call(arguments);n.unshift("PeerJS: ");for(var r=0,o=n.length;r<o;r++)n[r]instanceof Error&&(n[r]="("+n[r].name+") "+n[r].message,e=!0);e?console.error.apply(console,n):console.log.apply(console,n)},defaultConfig:n,browser:window.mozRTCPeerConnection?"Firefox":window.webkitRTCPeerConnection?"Chrome":window.RTCPeerConnection?"Supported":"Unsupported",supports:function(){if(void 0===t)return{};var e,r,o=!0,a=!0,i=!1,c=!1,l=!!window.webkitRTCPeerConnection;try{e=new t(n,{optional:[{RtpDataChannels:!0}]})}catch(e){o=!1,a=!1}if(o)try{r=e.createDataChannel("_PEERJSTEST")}catch(e){o=!1}if(o){try{r.binaryType="blob",i=!0}catch(e){}var u=new t(n,{});try{c=u.createDataChannel("_PEERJSRELIABLETEST",{}).reliable}catch(e){}u.close()}return a&&(a=!!e.addStream),e&&e.close(),{audioVideo:a,data:o,binaryBlob:i,binary:c,reliable:c,sctp:c,onnegotiationneeded:l}}(),validateId:function(e){return!e||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.exec(e)},validateKey:function(e){return!e||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.exec(e)},debug:!1,inherits:function(e,n){e.super_=n,e.prototype=Object.create(n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})},extend:function(e,n){for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r]);return e},pack:o.pack,unpack:o.unpack,log:function(){if(a.debug){var e=!1,n=Array.prototype.slice.call(arguments);n.unshift("PeerJS: ");for(var r=0,o=n.length;r<o;r++)n[r]instanceof Error&&(n[r]="("+n[r].name+") "+n[r].message,e=!0);e?console.error.apply(console,n):console.log.apply(console,n)}},setZeroTimeout:function(e){var n=[],r="zero-timeout-message";function o(o){o.source==e&&o.data==r&&(o.stopPropagation&&o.stopPropagation(),n.length&&n.shift()())}return e.addEventListener?e.addEventListener("message",o,!0):e.attachEvent&&e.attachEvent("onmessage",o),function(o){n.push(o),e.postMessage(r,"*")}}(window),chunk:function(e){for(var n=[],o=e.size,t=index=0,i=Math.ceil(o/a.chunkedMTU);t<o;){var c=Math.min(o,t+a.chunkedMTU),l=e.slice(t,c),u={__peerData:r,n:index,data:l,total:i};n.push(u),t=c,index+=1}return r+=1,n},blobToArrayBuffer:function(e,n){var r=new FileReader;r.onload=function(e){n(e.target.result)},r.readAsArrayBuffer(e)},blobToBinaryString:function(e,n){var r=new FileReader;r.onload=function(e){n(e.target.result)},r.readAsBinaryString(e)},binaryStringToArrayBuffer:function(e){for(var n=new Uint8Array(e.length),r=0;r<e.length;r++)n[r]=255&e.charCodeAt(r);return n.buffer},randomToken:function(){return Math.random().toString(36).substr(2)},isSecure:function(){return"https:"===location.protocol}};module.exports=a;
},{"js-binarypack":"J6D+","./adapter":"4DZb"}],"LqgX":[function(require,module,exports) {
"use strict";function t(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function e(){}e.prototype._events=void 0,e.prototype.listeners=function(t){if(!this._events||!this._events[t])return[];if(this._events[t].fn)return[this._events[t].fn];for(var e=0,n=this._events[t].length,s=new Array(n);e<n;e++)s[e]=this._events[t][e].fn;return s},e.prototype.emit=function(t,e,n,s,r,i){if(!this._events||!this._events[t])return!1;var o,h,f=this._events[t],v=arguments.length;if("function"==typeof f.fn){switch(f.once&&this.removeListener(t,f.fn,!0),v){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,e),!0;case 3:return f.fn.call(f.context,e,n),!0;case 4:return f.fn.call(f.context,e,n,s),!0;case 5:return f.fn.call(f.context,e,n,s,r),!0;case 6:return f.fn.call(f.context,e,n,s,r,i),!0}for(h=1,o=new Array(v-1);h<v;h++)o[h-1]=arguments[h];f.fn.apply(f.context,o)}else{var c,a=f.length;for(h=0;h<a;h++)switch(f[h].once&&this.removeListener(t,f[h].fn,!0),v){case 1:f[h].fn.call(f[h].context);break;case 2:f[h].fn.call(f[h].context,e);break;case 3:f[h].fn.call(f[h].context,e,n);break;default:if(!o)for(c=1,o=new Array(v-1);c<v;c++)o[c-1]=arguments[c];f[h].fn.apply(f[h].context,o)}}return!0},e.prototype.on=function(e,n,s){var r=new t(n,s||this);return this._events||(this._events={}),this._events[e]?this._events[e].fn?this._events[e]=[this._events[e],r]:this._events[e].push(r):this._events[e]=r,this},e.prototype.once=function(e,n,s){var r=new t(n,s||this,!0);return this._events||(this._events={}),this._events[e]?this._events[e].fn?this._events[e]=[this._events[e],r]:this._events[e].push(r):this._events[e]=r,this},e.prototype.removeListener=function(t,e,n){if(!this._events||!this._events[t])return this;var s=this._events[t],r=[];if(e&&(s.fn&&(s.fn!==e||n&&!s.once)&&r.push(s),!s.fn))for(var i=0,o=s.length;i<o;i++)(s[i].fn!==e||n&&!s[i].once)&&r.push(s[i]);return r.length?this._events[t]=1===r.length?r[0]:r:delete this._events[t],this},e.prototype.removeAllListeners=function(t){return this._events?(t?delete this._events[t]:this._events={},this):this},e.prototype.off=e.prototype.removeListener,e.prototype.addListener=e.prototype.on,e.prototype.setMaxListeners=function(){return this},e.EventEmitter=e,e.EventEmitter2=e,e.EventEmitter3=e,module.exports=e;
},{}],"F3Do":[function(require,module,exports) {
var t=require("./util"),e=require("eventemitter3");function s(t,i,o,n,r,h){if(!(this instanceof s))return new s(t,i,o,n,r,h);h=h||o,e.call(this),this.disconnected=!1,this._queue=[];var a=t?"https://":"http://",_=t?"wss://":"ws://";this._httpUrl=a+i+":"+o+n+r,this._wsUrl=_+i+":"+h+n+"peerjs?key="+r}t.inherits(s,e),s.prototype.start=function(t,e){this.id=t,this._httpUrl+="/"+t+"/"+e,this._wsUrl+="&id="+t+"&token="+e,this._startXhrStream(),this._startWebSocket()},s.prototype._startWebSocket=function(e){var s=this;this._socket||(this._socket=new WebSocket(this._wsUrl),this._socket.onmessage=function(e){try{var i=JSON.parse(e.data)}catch(s){return void t.log("Invalid server message",e.data)}s.emit("message",i)},this._socket.onclose=function(e){t.log("Socket closed."),s.disconnected=!0,s.emit("disconnected")},this._socket.onopen=function(){s._timeout&&(clearTimeout(s._timeout),setTimeout(function(){s._http.abort(),s._http=null},5e3)),s._sendQueuedMessages(),t.log("Socket open")})},s.prototype._startXhrStream=function(e){try{var s=this;this._http=new XMLHttpRequest,this._http._index=1,this._http._streamIndex=e||0,this._http.open("post",this._httpUrl+"/id?i="+this._http._streamIndex,!0),this._http.onerror=function(){clearTimeout(s._timeout),s.emit("disconnected")},this._http.onreadystatechange=function(){2==this.readyState&&this.old?(this.old.abort(),delete this.old):this.readyState>2&&200===this.status&&this.responseText&&s._handleStream(this)},this._http.send(null),this._setHTTPTimeout()}catch(e){t.log("XMLHttpRequest not available; defaulting to WebSockets")}},s.prototype._handleStream=function(e){var s=e.responseText.split("\n");if(e._buffer)for(;e._buffer.length>0;){var i=e._buffer.shift(),o=s[i];try{o=JSON.parse(o)}catch(t){e._buffer.shift(i);break}this.emit("message",o)}var n=s[e._index];if(n)if(e._index+=1,e._index===s.length)e._buffer||(e._buffer=[]),e._buffer.push(e._index-1);else{try{n=JSON.parse(n)}catch(e){return void t.log("Invalid server message",n)}this.emit("message",n)}},s.prototype._setHTTPTimeout=function(){var t=this;this._timeout=setTimeout(function(){var e=t._http;t._wsOpen()?e.abort():(t._startXhrStream(e._streamIndex+1),t._http.old=e)},25e3)},s.prototype._wsOpen=function(){return this._socket&&1==this._socket.readyState},s.prototype._sendQueuedMessages=function(){for(var t=0,e=this._queue.length;t<e;t+=1)this.send(this._queue[t])},s.prototype.send=function(t){if(!this.disconnected)if(this.id)if(t.type){var e=JSON.stringify(t);if(this._wsOpen())this._socket.send(e);else{var s=new XMLHttpRequest,i=this._httpUrl+"/"+t.type.toLowerCase();s.open("post",i,!0),s.setRequestHeader("Content-Type","application/json"),s.send(e)}}else this.emit("error","Invalid message");else this._queue.push(t)},s.prototype.close=function(){!this.disconnected&&this._wsOpen()&&(this._socket.close(),this.disconnected=!0)},module.exports=s;
},{"./util":"zQTp","eventemitter3":"LqgX"}],"l1nn":[function(require,module,exports) {
var e=require("./util"),t=require("./adapter").RTCPeerConnection,n=require("./adapter").RTCSessionDescription,o=require("./adapter").RTCIceCandidate,r={pcs:{data:{},media:{}},queue:[],_idPrefix:"pc_",startConnection:function(t,n){var o=r._getPeerConnection(t,n);if(t.pc=t.peerConnection=o,"media"===t.type&&n._stream&&o.addStream(n._stream),n.originator){if("data"===t.type){var i={};e.supports.sctp||(i={reliable:n.reliable});var a=o.createDataChannel(t.label,i);t.initialize(a)}r._makeOffer(t)}else r.handleSDP("OFFER",t,n.sdp)},_getPeerConnection:function(t,n){r.pcs[t.type]||e.error(t.type+" is not a valid connection type. Maybe you overrode the `type` property somewhere."),r.pcs[t.type][t.peer]||(r.pcs[t.type][t.peer]={});var o;r.pcs[t.type][t.peer];return n.pc&&(o=r.pcs[t.type][t.peer][n.pc]),o&&"stable"===o.signalingState||(o=r._startPeerConnection(t)),o},_startPeerConnection:function(n){e.log("Creating RTCPeerConnection.");var o=r._idPrefix+e.randomToken(),i={};"data"!==n.type||e.supports.sctp?"media"===n.type&&(i={optional:[{DtlsSrtpKeyAgreement:!0}]}):i={optional:[{RtpDataChannels:!0}]};var a=new t(n.provider.options.config,i);return r.pcs[n.type][n.peer][o]=a,r._setupListeners(n,a,o),a},_setupListeners:function(t,n,o){var r=t.peer,i=t.id,a=t.provider;e.log("Listening for ICE candidates."),n.onicecandidate=function(n){n.candidate&&(e.log("Received ICE candidates for:",t.peer),a.socket.send({type:"CANDIDATE",payload:{candidate:n.candidate,type:t.type,connectionId:t.id},dst:r}))},n.oniceconnectionstatechange=function(){switch(n.iceConnectionState){case"failed":e.log("iceConnectionState is disconnected, closing connections to "+r),t.emit("error",new Error("Negotiation of connection to "+r+" failed.")),t.close();break;case"disconnected":e.log("iceConnectionState is disconnected, closing connections to "+r),t.close();break;case"completed":n.onicecandidate=e.noop}},n.onicechange=n.oniceconnectionstatechange,e.log("Listening for data channel"),n.ondatachannel=function(t){e.log("Received data channel");var n=t.channel;a.getConnection(r,i).initialize(n)},e.log("Listening for remote stream"),n.onaddstream=function(t){e.log("Received remote stream");var n=t.stream,o=a.getConnection(r,i);"media"===o.type&&o.addStream(n)}},cleanup:function(t){e.log("Cleaning up PeerConnection to "+t.peer);var n=t.pc;n&&(n.readyState&&"closed"!==n.readyState||"closed"!==n.signalingState)&&(n.close(),t.pc=null)},_makeOffer:function(t){var n=t.pc;n.createOffer(function(o){e.log("Created offer."),!e.supports.sctp&&"data"===t.type&&t.reliable&&(o.sdp=Reliable.higherBandwidthSDP(o.sdp)),n.setLocalDescription(o,function(){e.log("Set localDescription: offer","for:",t.peer),t.provider.socket.send({type:"OFFER",payload:{sdp:o,type:t.type,label:t.label,connectionId:t.id,reliable:t.reliable,serialization:t.serialization,metadata:t.metadata,browser:e.browser},dst:t.peer})},function(n){"OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"!=n&&(t.provider.emitError("webrtc",n),e.log("Failed to setLocalDescription, ",n))})},function(n){t.provider.emitError("webrtc",n),e.log("Failed to createOffer, ",n)},t.options.constraints)},_makeAnswer:function(t){var n=t.pc;n.createAnswer(function(o){e.log("Created answer."),!e.supports.sctp&&"data"===t.type&&t.reliable&&(o.sdp=Reliable.higherBandwidthSDP(o.sdp)),n.setLocalDescription(o,function(){e.log("Set localDescription: answer","for:",t.peer),t.provider.socket.send({type:"ANSWER",payload:{sdp:o,type:t.type,connectionId:t.id,browser:e.browser},dst:t.peer})},function(n){t.provider.emitError("webrtc",n),e.log("Failed to setLocalDescription, ",n)})},function(n){t.provider.emitError("webrtc",n),e.log("Failed to create answer, ",n)})},handleSDP:function(t,o,i){i=new n(i);var a=o.pc;e.log("Setting remote description",i),a.setRemoteDescription(i,function(){e.log("Set remoteDescription:",t,"for:",o.peer),"OFFER"===t&&r._makeAnswer(o)},function(t){o.provider.emitError("webrtc",t),e.log("Failed to setRemoteDescription, ",t)})},handleCandidate:function(t,n){var r=n.candidate,i=n.sdpMLineIndex;t.pc.addIceCandidate(new o({sdpMLineIndex:i,candidate:r})),e.log("Added ICE candidate for:",t.peer)}};module.exports=r;
},{"./util":"zQTp","./adapter":"4DZb"}],"W/YE":[function(require,module,exports) {
var t=require("./util"),e=require("eventemitter3"),i=require("./negotiator");function s(a,o,n){if(!(this instanceof s))return new s(a,o,n);e.call(this),this.options=t.extend({},n),this.open=!1,this.type="media",this.peer=a,this.provider=o,this.metadata=this.options.metadata,this.localStream=this.options._stream,this.id=this.options.connectionId||s._idPrefix+t.randomToken(),this.localStream&&i.startConnection(this,{_stream:this.localStream,originator:!0})}t.inherits(s,e),s._idPrefix="mc_",s.prototype.addStream=function(e){t.log("Receiving stream",e),this.remoteStream=e,this.emit("stream",e)},s.prototype.handleMessage=function(e){var s=e.payload;switch(e.type){case"ANSWER":i.handleSDP(e.type,this,s.sdp),this.open=!0;break;case"CANDIDATE":i.handleCandidate(this,s.candidate);break;default:t.warn("Unrecognized message type:",e.type,"from peer:",this.peer)}},s.prototype.answer=function(e){if(this.localStream)t.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");else{this.options._payload._stream=e,this.localStream=e,i.startConnection(this,this.options._payload);for(var s=this.provider._getMessages(this.id),a=0,o=s.length;a<o;a+=1)this.handleMessage(s[a]);this.open=!0}},s.prototype.close=function(){this.open&&(this.open=!1,i.cleanup(this),this.emit("close"))},module.exports=s;
},{"./util":"zQTp","eventemitter3":"LqgX","./negotiator":"l1nn"}],"rdQ2":[function(require,module,exports) {
var global = arguments[3];
var e=arguments[3],r=require("js-binarypack"),t={debug:!1,inherits:function(e,r){e.super_=r,e.prototype=Object.create(r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})},extend:function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t]);return e},pack:r.pack,unpack:r.unpack,log:function(){if(t.debug){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];e.unshift("Reliable: "),console.log.apply(console,e)}},setZeroTimeout:function(e){var r=[],t="zero-timeout-message";function n(n){n.source==e&&n.data==t&&(n.stopPropagation&&n.stopPropagation(),r.length&&r.shift()())}return e.addEventListener?e.addEventListener("message",n,!0):e.attachEvent&&e.attachEvent("onmessage",n),function(n){r.push(n),e.postMessage(t,"*")}}(this),blobToArrayBuffer:function(e,r){var t=new FileReader;t.onload=function(e){r(e.target.result)},t.readAsArrayBuffer(e)},blobToBinaryString:function(e,r){var t=new FileReader;t.onload=function(e){r(e.target.result)},t.readAsBinaryString(e)},binaryStringToArrayBuffer:function(e){for(var r=new Uint8Array(e.length),t=0;t<e.length;t++)r[t]=255&e.charCodeAt(t);return r.buffer},randomToken:function(){return Math.random().toString(36).substr(2)}};module.exports=t;
},{"js-binarypack":"J6D+"}],"k+rQ":[function(require,module,exports) {
var t=require("./util");function e(n,i){if(!(this instanceof e))return new e(n);this._dc=n,t.debug=i,this._outgoing={},this._incoming={},this._received={},this._window=1e3,this._mtu=500,this._interval=0,this._count=0,this._queue=[],this._setupDC()}e.prototype.send=function(e){var n=t.pack(e);n.size<this._mtu?this._handleSend(["no",n]):(this._outgoing[this._count]={ack:0,chunks:this._chunk(n)},t.debug&&(this._outgoing[this._count].timer=new Date),this._sendWindowedChunks(this._count),this._count+=1)},e.prototype._setupInterval=function(){var t=this;this._timeout=setInterval(function(){var e=t._queue.shift();if(e._multiple)for(var n=0,i=e.length;n<i;n+=1)t._intervalSend(e[n]);else t._intervalSend(e)},this._interval)},e.prototype._intervalSend=function(e){var n=this;e=t.pack(e),t.blobToBinaryString(e,function(t){n._dc.send(t)}),0===n._queue.length&&(clearTimeout(n._timeout),n._timeout=null)},e.prototype._processAcks=function(){for(var t in this._outgoing)this._outgoing.hasOwnProperty(t)&&this._sendWindowedChunks(t)},e.prototype._handleSend=function(t){for(var e=!0,n=0,i=this._queue.length;n<i;n+=1){var o=this._queue[n];o===t?e=!1:o._multiple&&-1!==o.indexOf(t)&&(e=!1)}e&&(this._queue.push(t),this._timeout||this._setupInterval())},e.prototype._setupDC=function(){var e=this;this._dc.onmessage=function(n){var i=n.data;if(i.constructor===String){var o=t.binaryStringToArrayBuffer(i);i=t.unpack(o),e._handleMessage(i)}}},e.prototype._handleMessage=function(e){var n,i=e[1],o=this._incoming[i],s=this._outgoing[i];switch(e[0]){case"no":var a=i;a&&this.onmessage(t.unpack(a));break;case"end":if(n=o,this._received[i]=e[2],!n)break;this._ack(i);break;case"ack":if(n=s){var h=e[2];n.ack=Math.max(h,n.ack),n.ack>=n.chunks.length?(t.log("Time: ",new Date-n.timer),delete this._outgoing[i]):this._processAcks()}break;case"chunk":if(!(n=o)){if(!0===this._received[i])break;n={ack:["ack",i,0],chunks:[]},this._incoming[i]=n}var r=e[2],u=e[3];n.chunks[r]=new Uint8Array(u),r===n.ack[2]&&this._calculateNextAck(i),this._ack(i);break;default:this._handleSend(e)}},e.prototype._chunk=function(e){for(var n=[],i=e.size,o=0;o<i;){var s=Math.min(i,o+this._mtu),a={payload:e.slice(o,s)};n.push(a),o=s}return t.log("Created",n.length,"chunks."),n},e.prototype._ack=function(t){var e=this._incoming[t].ack;this._received[t]===e[2]&&(this._complete(t),this._received[t]=!0),this._handleSend(e)},e.prototype._calculateNextAck=function(t){for(var e=this._incoming[t],n=e.chunks,i=0,o=n.length;i<o;i+=1)if(void 0===n[i])return void(e.ack[2]=i);e.ack[2]=n.length},e.prototype._sendWindowedChunks=function(e){t.log("sendWindowedChunks for: ",e);for(var n=this._outgoing[e],i=n.chunks,o=[],s=Math.min(n.ack+this._window,i.length),a=n.ack;a<s;a+=1)i[a].sent&&a!==n.ack||(i[a].sent=!0,o.push(["chunk",e,a,i[a].payload]));n.ack+this._window>=i.length&&o.push(["end",e,i.length]),o._multiple=!0,this._handleSend(o)},e.prototype._complete=function(e){t.log("Completed called for",e);var n=this,i=this._incoming[e].chunks,o=new Blob(i);t.blobToArrayBuffer(o,function(e){n.onmessage(t.unpack(e))}),delete this._incoming[e]},e.higherBandwidthSDP=function(t){var e=navigator.appVersion.match(/Chrome\/(.*?) /);if(e&&(e=parseInt(e[1].split(".").shift()))<31){var n=t.split("b=AS:30");if(n.length>1)return n[0]+"b=AS:102400"+n[1]}return t},e.prototype.onmessage=function(t){},module.exports.Reliable=e;
},{"./util":"rdQ2"}],"m5AI":[function(require,module,exports) {
var e=require("./util"),t=require("eventemitter3"),i=require("./negotiator"),n=require("reliable");function s(n,r,a){if(!(this instanceof s))return new s(n,r,a);t.call(this),this.options=e.extend({serialization:"binary",reliable:!1},a),this.open=!1,this.type="data",this.peer=n,this.provider=r,this.id=this.options.connectionId||s._idPrefix+e.randomToken(),this.label=this.options.label||this.id,this.metadata=this.options.metadata,this.serialization=this.options.serialization,this.reliable=this.options.reliable,this._buffer=[],this._buffering=!1,this.bufferSize=0,this._chunkedData={},this.options._payload&&(this._peerBrowser=this.options._payload.browser),i.startConnection(this,this.options._payload||{originator:!0})}e.inherits(s,t),s._idPrefix="dc_",s.prototype.initialize=function(e){this._dc=this.dataChannel=e,this._configureDataChannel()},s.prototype._configureDataChannel=function(){var t=this;e.supports.sctp&&(this._dc.binaryType="arraybuffer"),this._dc.onopen=function(){e.log("Data channel connection success"),t.open=!0,t.emit("open")},!e.supports.sctp&&this.reliable&&(this._reliable=new n(this._dc,e.debug)),this._reliable?this._reliable.onmessage=function(e){t.emit("data",e)}:this._dc.onmessage=function(e){t._handleDataMessage(e)},this._dc.onclose=function(i){e.log("DataChannel closed for:",t.peer),t.close()}},s.prototype._handleDataMessage=function(t){var i=this,n=t.data,s=n.constructor;if("binary"===this.serialization||"binary-utf8"===this.serialization){if(s===Blob)return void e.blobToArrayBuffer(n,function(t){n=e.unpack(t),i.emit("data",n)});if(s===ArrayBuffer)n=e.unpack(n);else if(s===String){var r=e.binaryStringToArrayBuffer(n);n=e.unpack(r)}}else"json"===this.serialization&&(n=JSON.parse(n));if(n.__peerData){var a=n.__peerData,o=this._chunkedData[a]||{data:[],count:0,total:n.total};return o.data[n.n]=n.data,o.count+=1,o.total===o.count&&(delete this._chunkedData[a],n=new Blob(o.data),this._handleDataMessage({data:n})),void(this._chunkedData[a]=o)}this.emit("data",n)},s.prototype.close=function(){this.open&&(this.open=!1,i.cleanup(this),this.emit("close"))},s.prototype.send=function(t,i){if(this.open)if(this._reliable)this._reliable.send(t);else{var n=this;if("json"===this.serialization)this._bufferedSend(JSON.stringify(t));else if("binary"===this.serialization||"binary-utf8"===this.serialization){var s=e.pack(t);if((e.chunkedBrowsers[this._peerBrowser]||e.chunkedBrowsers[e.browser])&&!i&&s.size>e.chunkedMTU)return void this._sendChunks(s);e.supports.sctp?e.supports.binaryBlob?this._bufferedSend(s):e.blobToArrayBuffer(s,function(e){n._bufferedSend(e)}):e.blobToBinaryString(s,function(e){n._bufferedSend(e)})}else this._bufferedSend(t)}else this.emit("error",new Error("Connection is not open. You should listen for the `open` event before sending messages."))},s.prototype._bufferedSend=function(e){!this._buffering&&this._trySend(e)||(this._buffer.push(e),this.bufferSize=this._buffer.length)},s.prototype._trySend=function(e){try{this._dc.send(e)}catch(e){this._buffering=!0;var t=this;return setTimeout(function(){t._buffering=!1,t._tryBuffer()},100),!1}return!0},s.prototype._tryBuffer=function(){if(0!==this._buffer.length){var e=this._buffer[0];this._trySend(e)&&(this._buffer.shift(),this.bufferSize=this._buffer.length,this._tryBuffer())}},s.prototype._sendChunks=function(t){for(var i=e.chunk(t),n=0,s=i.length;n<s;n+=1){t=i[n];this.send(t,!0)}},s.prototype.handleMessage=function(t){var n=t.payload;switch(t.type){case"ANSWER":this._peerBrowser=n.browser,i.handleSDP(t.type,this,n.sdp);break;case"CANDIDATE":i.handleCandidate(this,n.candidate);break;default:e.warn("Unrecognized message type:",t.type,"from peer:",this.peer)}},module.exports=s;
},{"./util":"zQTp","eventemitter3":"LqgX","./negotiator":"l1nn","reliable":"k+rQ"}],"L0SA":[function(require,module,exports) {
var e=require("./util"),t=require("eventemitter3"),o=require("./socket"),n=require("./mediaconnection"),i=require("./dataconnection");function s(o,n){if(!(this instanceof s))return new s(o,n);t.call(this),o&&o.constructor==Object?(n=o,o=void 0):o&&(o=o.toString()),(n=e.extend({debug:0,host:e.CLOUD_HOST,port:e.CLOUD_PORT,path:"/",token:e.randomToken(),config:e.defaultConfig},n)).key="peerjs",this.options=n,"/"===n.host&&(n.host=window.location.hostname),"/"!==n.path[0]&&(n.path="/"+n.path),"/"!==n.path[n.path.length-1]&&(n.path+="/"),void 0===n.secure&&n.host!==e.CLOUD_HOST&&(n.secure=e.isSecure()),n.logFunction&&e.setLogFunction(n.logFunction),e.setLogLevel(n.debug),e.supports.audioVideo||e.supports.data?e.validateId(o)?(this.destroyed=!1,this.disconnected=!1,this.open=!1,this.connections={},this._lostMessages={},this._initializeServerConnection(),o?this._initialize(o):this._retrieveId()):this._delayedAbort("invalid-id",'ID "'+o+'" is invalid'):this._delayedAbort("browser-incompatible","The current browser does not support WebRTC")}e.inherits(s,t),s.prototype._initializeServerConnection=function(){var e=this;this.socket=new o(this.options.secure,this.options.host,this.options.port,this.options.path,this.options.key,this.options.wsport),this.socket.on("message",function(t){e._handleMessage(t)}),this.socket.on("error",function(t){e._abort("socket-error",t)}),this.socket.on("disconnected",function(){e.disconnected||(e.emitError("network","Lost connection to server."),e.disconnect())}),this.socket.on("close",function(){e.disconnected||e._abort("socket-closed","Underlying socket is already closed.")})},s.prototype._retrieveId=function(t){var o=this,n=new XMLHttpRequest,i=(this.options.secure?"https://":"http://")+this.options.host+":"+this.options.port+this.options.path+this.options.key+"/id";i+="?ts="+(new Date).getTime()+Math.random(),n.open("get",i,!0),n.onerror=function(t){e.error("Error retrieving ID",t);var n="";"/"===o.options.path&&o.options.host!==e.CLOUD_HOST&&(n=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),o._abort("server-error","Could not get an ID from the server."+n)},n.onreadystatechange=function(){4===n.readyState&&(200===n.status?o._initialize(n.responseText):n.onerror())},n.send(null)},s.prototype._initialize=function(e){this.id=e,this.socket.start(this.id,this.options.token)},s.prototype._handleMessage=function(t){var o,s=t.type,r=t.payload,a=t.src;switch(s){case"OPEN":this.emit("open",this.id),this.open=!0;break;case"ERROR":this._abort("server-error",r.msg);break;case"ID-TAKEN":this._abort("unavailable-id","ID `"+this.id+"` is taken");break;case"INVALID-KEY":this._abort("invalid-key",'API KEY "'+this.options.key+'" is invalid');break;case"LEAVE":e.log("Received leave message from",a),this._cleanupPeer(a);break;case"EXPIRE":this.emitError("peer-unavailable","Could not connect to peer "+a);break;case"OFFER":var c=r.connectionId;if((o=this.getConnection(a,c))&&(o.close(),e.warn("Offer received for existing Connection ID:",c)),"media"===r.type)o=new n(a,this,{connectionId:c,_payload:r,metadata:r.metadata}),this._addConnection(a,o),this.emit("call",o);else{if("data"!==r.type)return void e.warn("Received malformed connection type:",r.type);o=new i(a,this,{connectionId:c,_payload:r,metadata:r.metadata,label:r.label,serialization:r.serialization,reliable:r.reliable}),this._addConnection(a,o),this.emit("connection",o)}for(var h=this._getMessages(c),d=0,l=h.length;d<l;d+=1)o.handleMessage(h[d]);break;default:if(!r)return void e.warn("You received a malformed message from "+a+" of type "+s);var p=r.connectionId;(o=this.getConnection(a,p))&&o.pc?o.handleMessage(t):p?this._storeMessage(p,t):e.warn("You received an unrecognized message:",t)}},s.prototype._storeMessage=function(e,t){this._lostMessages[e]||(this._lostMessages[e]=[]),this._lostMessages[e].push(t)},s.prototype._getMessages=function(e){var t=this._lostMessages[e];return t?(delete this._lostMessages[e],t):[]},s.prototype.connect=function(t,o){if(this.disconnected)return e.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),void this.emitError("disconnected","Cannot connect to new Peer after disconnecting from server.");var n=new i(t,this,o);return this._addConnection(t,n),n},s.prototype.call=function(t,o,i){if(this.disconnected)return e.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),void this.emitError("disconnected","Cannot connect to new Peer after disconnecting from server.");if(o){(i=i||{})._stream=o;var s=new n(t,this,i);return this._addConnection(t,s),s}e.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.")},s.prototype._addConnection=function(e,t){this.connections[e]||(this.connections[e]=[]),this.connections[e].push(t)},s.prototype.getConnection=function(e,t){var o=this.connections[e];if(!o)return null;for(var n=0,i=o.length;n<i;n++)if(o[n].id===t)return o[n];return null},s.prototype._delayedAbort=function(t,o){var n=this;e.setZeroTimeout(function(){n._abort(t,o)})},s.prototype._abort=function(t,o){e.error("Aborting!"),this._lastServerId?this.disconnect():this.destroy(),this.emitError(t,o)},s.prototype.emitError=function(t,o){e.error("Error:",o),"string"==typeof o&&(o=new Error(o)),o.type=t,this.emit("error",o)},s.prototype.destroy=function(){this.destroyed||(this._cleanup(),this.disconnect(),this.destroyed=!0)},s.prototype._cleanup=function(){if(this.connections)for(var e=Object.keys(this.connections),t=0,o=e.length;t<o;t++)this._cleanupPeer(e[t]);this.emit("close")},s.prototype._cleanupPeer=function(e){for(var t=this.connections[e],o=0,n=t.length;o<n;o+=1)t[o].close()},s.prototype.disconnect=function(){var t=this;e.setZeroTimeout(function(){t.disconnected||(t.disconnected=!0,t.open=!1,t.socket&&t.socket.close(),t.emit("disconnected",t.id),t._lastServerId=t.id,t.id=null)})},s.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed)e.log("Attempting reconnection to server with ID "+this._lastServerId),this.disconnected=!1,this._initializeServerConnection(),this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(this.disconnected||this.open)throw new Error("Peer "+this.id+" cannot reconnect because it is not disconnected from the server!");e.error("In a hurry? We're still trying to make the initial connection!")}},s.prototype.listAllPeers=function(t){t=t||function(){};var o=this,n=new XMLHttpRequest,i=(this.options.secure?"https://":"http://")+this.options.host+":"+this.options.port+this.options.path+this.options.key+"/peers";i+="?ts="+(new Date).getTime()+Math.random(),n.open("get",i,!0),n.onerror=function(e){o._abort("server-error","Could not get peers from the server."),t([])},n.onreadystatechange=function(){if(4===n.readyState){if(401===n.status){var i="";throw i=o.options.host!==e.CLOUD_HOST?"It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":"You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",t([]),new Error("It doesn't look like you have permission to list peers IDs. "+i)}200!==n.status?t([]):t(JSON.parse(n.responseText))}},n.send(null)},module.exports=s;
},{"./util":"zQTp","eventemitter3":"LqgX","./socket":"F3Do","./mediaconnection":"W/YE","./dataconnection":"m5AI"}],"v86a":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./helpers"),t=require("./tetris"),i=r(t),n=require("./drawable"),s=r(n),o=require("peerjs"),a=r(o);function r(e){return e&&e.__esModule?e:{default:e}}function h(t,n){this.initialize=function(){var e=this;this.options={playable:!1,half:!1},Object.assign(this.options,n),this.sendGroundLoopInterval=null,this.parent=t,this.createHtmlElements(t),this.createDrawables(),this.createTetrisGame(),this.attachWindowEvents(),this.options.playable&&(this.startPieceMoveDownLoop(),this.startDrawLoop()),this.handleResize(),setTimeout(function(){e.handleResize()},1e3)},this.addReplica=function(e){var t=new h(this.parent,{playable:!1,half:!0});this.sendGroundLoop(e),e.on("data",function(e){t.tetris.loadSerializedData(e)}),e.on("close",function(){t.destroy()}),t.handleResize()},this.destroy=function(){this.parent.removeChild(this.element)},this.attachWindowEvents=function(){var e=this;window.addEventListener("load",function(){e.handleResize()}),window.addEventListener("resize",function(){e.handleResize()}),this.options.playable&&(setTimeout(function(){e.createPeer()},1e3),window.addEventListener("keydown",function(t){e.handleKeyboardEvent(t)}),window.addEventListener("keyup",function(t){e.handleKeyboardEvent(t)}))},this.createTetrisGame=function(){this.tetris=new i.default({drawableBackground:this.background,drawablePieces:this.pieces})},this.createHtmlElements=function(){var e=document.createElement("div");this.options.half?e.className="tetris-container-half":e.className="tetris-container",t.appendChild(e);var i=document.createElement("div");i.className="tetris-container-inner",e.appendChild(i),this.element=e,this.elementInner=i},this.createDrawables=function(){this.background=new s.default,this.pieces=new s.default,this.background.createAndAppend(this.elementInner),this.pieces.createAndAppend(this.elementInner)},this.handleResize=function(){var t=(0,e.getElementSize)(this.element),i=t.height/this.tetris.options.groundHeight;i*this.tetris.options.groundWidth>t.width&&(i=t.width/this.tetris.options.groundWidth),i=parseInt(i),t={width:this.tetris.options.groundWidth*i,height:this.tetris.options.groundHeight*i},this.background.resize(t),this.pieces.resize(t),this.tetris.resize(i)},this.moveDown=(0,e.throttle)(function(){this.tetris.pieceMoveDown()}.bind(this),40),this.moveLeft=(0,e.throttle)(function(){this.tetris.pieceMoveLeft()}.bind(this),100),this.moveRight=(0,e.throttle)(function(){this.tetris.pieceMoveRight()}.bind(this),100),this.handleKeyboardEvent=function(e){switch(e.which){case 80:e.type;break;case 37:"keydown"===e.type&&this.moveLeft();break;case 38:"keyup"===e.type&&this.tetris.rotatePieceCounterClockwise();break;case 39:"keydown"===e.type&&this.moveRight();break;case 82:this.tetris.reset();break;case 40:this.moveDown();break;case 32:"keyup"===e.type&&this.tetris.rotatePieceCounterClockwise();break;case 78:if("keyup"===e.type){var t=window.prompt("I the other name");this.connect(t)}break;default:console.log("which",e.which)}}.bind(this),this.sendGroundLoop=function(e){var t=this;clearInterval(this.sendGroundLoopInterval),this.sendGroundLoopInterval=setInterval(function(){e.send(t.tetris.serialize())},1e3)},this.connect=function(e){var t=this,i=this.peer.connect("zIKosj1p"+e);i.on("open",function(){t.addReplica(i)})},this.startPieceMoveDownLoop=function(){var e=this;setInterval(function(){e.tetris.pieceMoveDown({auto:!0})},800)},this.startDrawLoop=function(){var e=this;setInterval(function(){e.tetris.draw()},30)},this.createPeer=function(){var e=this;this.name=window.prompt("I need your name"),this.peer=new a.default("zIKosj1p"+this.name),this.peer.on("connection",function(t){e.addReplica(t)})},this.initialize()}exports.default=h;
},{"./helpers":"lTk1","./tetris":"+LqT","./drawable":"rwa0","peerjs":"L0SA"}],"epB2":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),require("./main.css");var e=require("./htmlgame"),t=r(e);function r(e){return e&&e.__esModule?e:{default:e}}var u=document.getElementById("main-tetris"),a=new t.default(u,{playable:!0});exports.default=function(){};
},{"./main.css":"Sr7R","./htmlgame":"v86a"}],"Focm":[function(require,module,exports) {
"use strict";var e=require("./main"),u=r(e);function r(e){return e&&e.__esModule?e:{default:e}}(0,u.default)();
},{"./main":"epB2"}]},{},["Focm"], null)
//# sourceMappingURL=https://pardo.github.io/tetris/rough_maze.74358c28.map